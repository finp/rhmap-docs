<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book [
<!ENTITY % sgml.features "IGNORE">
<!ENTITY % xml.features "INCLUDE">
<!ENTITY % DOCBOOK_ENTS PUBLIC "-//OASIS//ENTITIES DocBook Character Entities V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/dbcentx.mod">
%DOCBOOK_ENTS;
]>
<?asciidoc-toc maxdepth="4"?><?asciidoc-numbered?><book xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Client API</title><subtitle>For Red Hat Mobile Application Platform Hosted 3</subtitle>

<date>2017-07-10</date>
<productname>Red Hat Mobile Application Platform Hosted</productname>
<productnumber>3</productnumber>
<release>3</release>
<abstract>
    <para>This document is a reference of the RHMAP Client API.</para>
</abstract>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Author_Group.xml"/>
<xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="Common_Content/Legal_Notice.xml"/>
</info>
<preface>
<title>Preface</title>
<simpara>Table key:</simpara>
<simpara>C - Cordova</simpara>
<simpara>W - Web Apps</simpara>
<simpara>A2 - Android SDK</simpara>
<simpara>I1 - iOS Objective-C</simpara>
<simpara>I2 - SDK iOS</simpara>
<simpara>S - Swift SDK</simpara>
<simpara>X - Xamarin</simpara>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="8">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="7*"/>
<colspec colname="col_3" colwidth="7*"/>
<colspec colname="col_4" colwidth="7*"/>
<colspec colname="col_5" colwidth="7*"/>
<colspec colname="col_6" colwidth="7*"/>
<colspec colname="col_7" colwidth="7*"/>
<colspec colname="col_8" colwidth="7*"/>
<thead>
<row>
<entry align="left" valign="top">API	Name and description</entry>
<entry align="left" valign="top">C</entry>
<entry align="left" valign="top">W1</entry>
<entry align="left" valign="top">A2</entry>
<entry align="left" valign="top">i1</entry>
<entry align="left" valign="top">i2</entry>
<entry align="left" valign="top">S</entry>
<entry align="left" valign="top">X</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-auth">$fh.auth</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-cloud">$fh.cloud</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-getCloudURL">$fh.getcloudurl</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-getFHParams">$fh.getfhparams</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-forms">$fh.forms</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-hash">$fh.hash</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-init">$fh.init</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-mbaas">$fh.mbaas</link></simpara></entry>
<entry align="left" valign="top"/>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-push">$fh.push</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-sec">$fh.sec</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
<entry align="left" valign="top"/>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-sync">$fh.sync</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><link linkend="fh-act">$fh.act</link></simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
<entry align="left" valign="top"><simpara>y</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</preface>
<chapter xml:id="fh-auth">
<title>$fh.auth</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.auth(options, success, failure);</programlisting>
<simpara>Authenticate and optionally authorise a user via access rights management. Note that in order to use fh.auth, you will need to have a domain Administrator account. Read about our user levels here: <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/product-features/#administration">User Administration</link>. If you intend to use $fh.auth against an oauth provider, take a look at setting up an <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/product-features/#auth-policies">OAuth Policy</link>.</simpara>
<simpara>Generally speaking, if the Auth type is FeedHenry or LDAP, you just need to construct a view to allow users to enter their credentials and set them on the auth request instance.</simpara>
<simpara>If the auth policy type is OAuth, the authentication process is quite complicated. The user has to login to the OAuth provider’s login page and give permission to allow the application to access his/her information.</simpara>
<simpara>To make this process easier to handle, the native SDKs (iOS, Android and .NET) provide extra UI components to handle this seemlessly: the UI component appears on the screen and loads the OAuth provider’s authentication page. The component will know when the OAuth process is finished and close itself automatically and pass the results back to the success or failure function. The UI component will look like this:</simpara>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/shared/images/ios_oauth_sample.png"/>
</imageobject>
<textobject><phrase>iOS_OAuth_Sample.png</phrase></textobject>
</inlinemediaobject></simpara>
<itemizedlist xml:id="auth-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="auth-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">// LDAP or Platform User Example
$fh.auth({
  "policyId": "My LDAP Auth Policy", // name of auth policy to use - see link:{ProductFeatures}#administration[Auth Policies Administration] for details on how to configure an auth policy
  "clientToken": "myAppId", // Your App ID
  "endRedirectUrl": window.location.href, // The URL to return to after authentication. Optional
  "params": { // the parameters associated with the requested auth policy - see below for full details.
    "userId": "joe@bloggs.com", // LDAP or Platform username
    "password": "password" // LDAP or Platform password
  }
}, function (res) {
  // Authentication successful - store sessionToken in variable
  var sessionToken = res.sessionToken; // The platform session identifier
  var authResponse = res.authResponse; // The authentication information returned from the authentication service.
  // This may include things such as validated email address,
  // OAuth token or other response data from the authentication service
}, function (msg, err) {
  var errorMsg = err.message;
  /* Possible errors:
    unknown_policyId - The policyId provided did not match any defined policy. Check the auth policies defined. See link:{ProductFeatures}#administration[Auth Policies Administration]
      user_not_found - The auth policy associated with the policyId provided has been set up to require that all users authenticating exist on the platform, but this user does not exists.
      user_not_approved - - The auth policy associated with the policyId provided has been set up to require that all users authenticating are in a list of approved users, but this user is not in that list.
        user_disabled - The user has been disabled from logging in.
        user_purge_data - The user has been flagged for data purge and all local data should be deleted.
        device_disabled - The device has been disabled. No user or apps can log in from the requesting device.
        device_purge_data - The device has been flagged for data purge and all local data should be deleted.
    */
if (errorMsg === "user_purge_data" || errorMsg === "device_purge_data") {
  // User or device has been black listed from administration console and all local data should be wiped
} else {
  alert("Authentication failed - " + errorMsg);
}
});


// OAuth 2.0 Example
// OAuth does not require any params, instead the "authCallback" param should be set on the $fh.auth call.
// This should be a function name that you have defined, and will be called after Auth has completed.
$fh.auth({
  "policyId": "My OAuth Policy",
  "clientToken": "myAppId",
  "authCallback": "authLoginCallback",
  "endRedirectUrl": window.location.href
}, function () {
  //
}, function () {
  //
});

var authLoginCallback = function(err, res) {
  if (!err) {
    // Authentication successful - store sessionToken in variable
    var sessionToken = res.sessionToken;
  } else {
    alert("Authentication failed - " + err.message);
  }
}</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>If you want to use the built-in OAuth handler as described in the example below, you need to add the following configuration into the <emphasis>application</emphasis> element of your application’s <emphasis>AndroidManifest.xml</emphasis> file</para>
</formalpara>
<programlisting language="xml" linenumbering="unnumbered">&lt;application&gt;
  ...
  &lt;activity android:name="com.feedhenry.sdk.oauth.FHOAuthIntent" /&gt;
&lt;/application&gt;</programlisting>
<note>
<simpara>Before invoking the Auth code, first ensure that <literal>FH.init</literal> code is initialized. For an example, see <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/client-api/#init-example">here</link>.</simpara>
</note>
<programlisting language="java" linenumbering="unnumbered">//Example code to authenticate a user with username and password that are defined in an auth policy called "MyFeedHenryPolicy"
private void loginWithFh(){
  EditText userField = (EditText) findViewById(R.id.fh_login_user);
  EditText passField = (EditText) findViewById(R.id.fh_login_password);
  String userName = userField.getText().toString();
  String password = passField.getText().toString();
if("".equals(userName)){
  FhUtil.showMessage(this, "Error", "User name is empty");
  return;
}
if("".equals(password)){
  FhUtil.showMessage(this, "Error", "Password is empty");
  return;
}
try{
  FHAuthRequest authRequest = FH.buildAuthRequest("MyFeedHenryPolicy", userName, password);
  authRequest.executeAsync(new FHActCallback() {


    @Override
    public void success(FHResponse resp) {
      Log.d("FHLoginActivity", "Login success");
    }

    @Override
    public void fail(FHResponse resp) {
      Log.d("FHLoginActivity", "Login fail");
    }
  });
}catch(Exception e){
  e.printStackTrace();
  }
}</programlisting>
<simpara>If the auth policy type is OAuth, an Intent will be invoked to load the OAuth provider’s authentication page. It will know when the OAuth process is finished and will close itself automatically and pass the results back to your success or failure function. To enable this, all you have to do is to call the <emphasis>setPresentingActivity</emphasis> method of the FHAuthRequest instance with your application’s context.</simpara>
<programlisting language="java" linenumbering="unnumbered">private void doOAuth(){
try{
FHAuthRequest authRequest = FH.buildAuthRequest();
authRequest.setPresentingActivity(this);
authRequest.setAuthPolicyId("MyGooglePolicy"); //"MyGooglePolicy" should be replaced with policy id you created
authRequest.executeAsync(new FHActCallback() {


    @Override
    public void success(FHResponse resp) {
      Log.d("FHAuthActivity", resp.getJson().toString());
    }

    @Override
    public void fail(FHResponse resp) {
      Log.d("FHAuthActivity", resp.getErrorMessage());
    }
  });
} catch(Exception e){
  Log.e("FHAuthActivity", e.getMessage(), e);
  }
}</programlisting>
<simpara>If the <literal>setPresentingActivity</literal> method is not called, you will have the chance to handle this by your own code. For example:</simpara>
<programlisting language="java" linenumbering="unnumbered">private void doOAuth(){
try{
  FHAuthRequest authRequest = FH.buildAuthRequest();
  authRequest.setAuthPolicyId("MyGooglePolicy"); //"MyGooglePolicy" should be replaced with policy id you created
  authRequest.executeAsync(new FHActCallback() {


    @Override
    public void success(FHResponse resp) {
      Log.d("FHAuthActivity", resp.getJson().toString());
      //because the setPresentingActivity method is not called, the reponse will contain a URL which should be used for user to login. Normally it should be loaded into a WebView
      String url = resp.getJson().getString("url");
      // load the url in a WebView, and then a seriers of redirects will happen
      // the last url will contain a string "status=complete"
      // and there will be a query parameter called "authResponse" in that url
      // the value of that parameter is the data returned from the OAuth provided (JSON stringified and URL encoded)
    }

    @Override
    public void fail(FHResponse resp) {
      Log.d("FHAuthActivity", resp.getErrorMessage());
    }
  });
} catch(Exception e){
  Log.e("FHAuthActivity", e.getMessage(), e);
  }
}</programlisting>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">//Example to authenticate user using username and password
NSString* userName = self.usernameField.text;
if(!userName){
  return [self showMessage:@"Error" message:@"User Name field is required"];
}
NSString* password = self.passwordField.text;
if(!password){
  return [self showMessage:@"Error" message:@"Password field is required"];
}
FHAuthReqeust* authRequest = [FH buildAuthRequest];
[authRequest authWithPolicyId:@"MyFeedHenryPolicy" UserId:userName Password:password]; //"MyFeedHenryPolicy" should be replaced with policy id you created
void (^success)(FHResponse *)=^(FHResponse * res){
  NSLog(@"parsed response %@ type=%@",res.parsedResponse,[res.parsedResponse class]);
  if ([[[res parsedResponse] valueForKey:@"status"] isEqualToString:@"error"]) {
    [self showMessage:@"Failed" message:%5Bres.parsedResponse valueForKey:@"message"]];
  } else {
    [self showMessage:@"Success" message:res.rawResponseAsString];
  }
};
void (^failure)(FHResponse *)=^(FHResponse* res){
  NSLog(@"parsed response %@ type=%@",res.parsedResponse,[res.parsedResponse class]);
  [self showMessage:@"Failed" message:res.rawResponseAsString];
};
[authRequest execAsyncWithSuccess:success AndFailure:failure];</programlisting>
</para>
</formalpara>
<simpara>If the auth policy type is OAuth, a UI component will be invoked to display the OAuth provider’s authentication page. The component waits until the OAuth process is finished, gets closed automatically afterwards, and passes the authentication results back to your success or failure function. To enable this, set the <literal>parentViewController</literal> property of the <literal>FHAuthRequest</literal> instance with an instance of <literal>UIViewController</literal> of your application.</simpara>
<programlisting language="objectivec" linenumbering="unnumbered">FHAuthReqeust * authRequest = [FH buildAuthRequest];
[authRequest authWithPolicyId:@"MyOAuthPolicy"]; //"MyOAuthPolicy" should be replaced with policy id you created
authRequest.parentViewController = viewController; //Important, this will enable the built-in OAuth hanlder
void (^success)(FHResponse *)=^(FHResponse * res){
  NSLog(@"parsed response %@ type=%@",res.parsedResponse,[res.parsedResponse class]);
  if ([[[res parsedResponse] valueForKey:@"status"] isEqualToString:@"error"]) {
    [self showMessage:@"Failed" message:%5Bres.parsedResponse valueForKey:@"message"]];
  } else {
    [self showMessage:@"Success" message:%5Bres.parsedResponse JSONString]];
  }
};
void (^failure)(FHResponse *)=^(FHResponse* res){
  NSLog(@"parsed response %@ type=%@",res.parsedResponse,[res.parsedResponse class]);
[self showMessage:@"Failed" message:res.rawResponseAsString];
};

[authRequest execAsyncWithSuccess:success AndFailure:failure]</programlisting>
<simpara>If the <emphasis>parentViewController</emphasis> property is not set, you will have the chance to handle this by your own code. For example:</simpara>
<programlisting language="objectivec" linenumbering="unnumbered">FHAuthReqeust* authRequest = [FH buildAuthRequest];
[authRequest authWithPolicyId:@"MyOAuthPolicy"]; //"MyOAuthPolicy" should be replaced with policy id you created
void (^success)(FHResponse *)=^(FHResponse * res){
  NSLog(@"parsed response %@ type=%@",res.parsedResponse,[res.parsedResponse class]);
  //because the parentViewController is not set, the reponse will contain a URL which should be used for user to login. Normally it should be loaded into a WebView
  NSString* oauthUrl = [res.parsedResponse valueForKey:@"url"];
  NSURL* request = [NSURL URLWithString:oauthUrl];
  // load the url in a WebView, and then a seriers of redirects will happen
  // the last url will contain a string "status=complete"
  // and there will be a query parameter called "authResponse" in that url
  // the value of that parameter is the data returned from the OAuth provided (JSON stringified and URL encoded)
};
void (^failure)(FHResponse *)=^(FHResponse* res){
  NSLog(@"parsed response %@ type=%@",res.parsedResponse,[res.parsedResponse class]);
  [self showMessage:@"Failed" message:res.rawResponseAsString];
};

[authRequest execAsyncWithSuccess:success AndFailure:failure];</programlisting>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">//Example to authenticate user using username and password
FH.auth("MyFeedHenryPolicy", userName: "me", password: "password", completionHandler: { (response: Response, error: NSError?) -&gt; Void in
  if let error = error {
    print("Error \(error)")
    return
  }
  if let response = response.parsedResponse as? [String: String]{
    if let status = response["status"] where status == "ok" {
      print("Response \(response)")
    } else if let status = response["status"] where status == "error" {
      let message = response["message"] ?? ""
      print("OAuth failed \(message)")
    }
  }
})</programlisting>
</para>
</formalpara>
<simpara>If the auth policy type is OAuth, a UI component will be invoked to load the OAuth provider’s authentication page. The component waits until the OAuth process is finished, gets closed automatically afterwards, and passes the authentication results back to your success or failure function. To enable this, set the <emphasis>parentViewController</emphasis> property of the <literal>AuthRequest</literal> instance with the instance of UIViewController for your application.</simpara>
<programlisting language="swift" linenumbering="unnumbered">let request = FH.authRequest("MyOAuthPolicy") //"MyOAuthPolicy" should be replaced with policy id you created
request.parentViewController = viewController //Important, this will enable the built-in OAuth handler
request.exec({ (response: Response, error: NSError?) -&gt; Void in
  if let error = error {
    print("Error connecting \(error)")
    return
  }
  if let response = response.parsedResponse as? [String: String] {
    if let status = response["status"] where status == "ok" {
      print("Response \(response)")
    } else if let status = response["status"] where status == "error" {
      let message = response["message"] ?? ""
      print("OAuth failed \(message)")
    }
  }
})</programlisting>
<simpara>If the <literal>parentViewController</literal> property is not set, you will have the chance to handle this by your own code. For example:</simpara>
<programlisting language="swift" linenumbering="unnumbered">let request = FH.authRequest("MyOAuthPolicy") //"MyOAuthPolicy" should be replaced with policy id you created
request.exec({ (response: Response, error: NSError?) -&gt; Void in
  if let error = error {
    print("Error connecting \(error)")
    return
  }
  if let response = response.parsedResponse as? [String: String] {
    if let status = response["status"] where status == "ok" {
      print("Response \(response)")
      // because the parentViewController is not set, the response will contain a URL which
      // should be used for user to login. Normally it should be loaded into a WebView
      if let urlString = response["url"] {
        let url = NSURL(string: urlString)
        // load the url in a WebView, and then a series of redirects will happen
        // the last url will contain a string "status=complete"
        // and there will be a query parameter called "authResponse" in that url
        // the value of that parameter is the data returned from the OAuth provided (JSON stringified and URL encoded).
      }    } else if let status = response["status"] where status == "error" {
let message = response["message"] ?? ""
print("OAuth failed \(message)")
}
}
})</programlisting>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">//Example to authenticate user using username and password
string authPolicy = "MyFeedHenryPolicy"; //"MyFeedHenryPolicy" should be replaced with policy id you created
string username = this.usernameField.Text;
string password = this.passwordField.Text;

FHResponse authRes = await FH.Auth(authPolicy, username, password);
if (null == authRes.Error)
{
    //user successfully logged in
}
else
{
    //login failed, show error
    ShowMessage(authRes.Error.Message);
}</programlisting>
</para>
</formalpara>
<simpara>If the auth policy type is OAuth, a UI component will be invoked to load the OAuth provider’s authentication page. It will know when the OAuth process is finished and will close itself automatically and pass the results back to your success or failure function.</simpara>
<programlisting language="csharp" linenumbering="unnumbered">string authPolicy = "TestGooglePolicy"; //"TestGooglePolicy" should be replaced with policy id you created
//When next line is executed, the user will be prompted with a new view to
//allow them enter their credentials on the OAuth provider's login page,
//and the result will be returned in FHResponse
FHResponse res = await FH.Auth(authPolicy);
if (null == res.Error)
{
    //user successfully logged in
}
else
{
    //login failed, show error
    ShowMessage(res.Error.Message);
}</programlisting>
<simpara>If you don’t want to use the default OAuth login handler provided by the SDK, you can provide your own implementation. All you have to do is to create an implementation for the <literal>IOAuthClientHandlerService</literal> interface, and use it like this:</simpara>
<programlisting language="csharp" linenumbering="unnumbered">//create a new instance of the custom IOAuthClientHandlerService
IOAuthClientHandlerService authHandler = new MyOAuthHandler();
//create a new auth request
FHAuthRequest authRequest = new FHAuthRequest();
authRequest.SetAuthPolicyId(policyId);
//set the request to use the custome oauth handler
authRequest.SetOAuthHandler(authHandler);
FHResponse res = await authRequest.execAsync();</programlisting>
</section>
<section xml:id="validate-sessions">
<title>Validate Sessions</title>
<important>
<simpara>To use this feature, you need to make sure the following versions of client and cloud SDKs are used:</simpara>
<itemizedlist>
<listitem>
<simpara>fh-js-sdk: &gt;= 2.6.0</simpara>
</listitem>
<listitem>
<simpara>fh-ios-sdk: &gt;= 2.2.8</simpara>
</listitem>
<listitem>
<simpara>fh-android-sdk: &gt;= 2.2.0</simpara>
</listitem>
<listitem>
<simpara>fh-dotnet-sdk: &gt;= 1.2.0</simpara>
</listitem>
<listitem>
<simpara>fh-mbaas-api: &gt;=4.10.0</simpara>
</listitem>
</itemizedlist>
</important>
<simpara>The <literal>sessionToken</literal> returned by the auth API will be persisted on the device, and will be added to all the <link linkend="fh-cloud">cloud API</link> calls afterwards automatically.</simpara>
<simpara>On the client side, new APIs are added to support session operations:</simpara>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">//To check if user is already authenticated
$fh.auth.hasSession(function(err, exist){
  if(err) {
    console.log('Failed to check session');
    return;
  }
  if(exist){
    //user is already authenticated
    //optionally we can also verify the session is actually valid from client. This requires network connection.
    $fh.auth.verify(function(err, valid){
      if(err){
        console.log('failed to verify session');
        return;
      }
      if(valid){
        console.log('session is valid');
      } else {
        console.log('session is not valid');
      }
    });
  } else {
    //user is not authenticated
  }
});

//When the user is logging out, the session should be cleared
$fh.auth.clearSession(function(err){

});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Java</title>
<para>
<programlisting language="java" linenumbering="unnumbered">//To check if user is already authenticated
boolean exists = FHAuthSession.exists();
if (exists) {
    //user is already authenticated
    //optionally we can also verify the session is actually valid from client. This requires network connection.
    FHAuthSession.verify(new FHAuthSession.Callback() {
      @Override
      public void handleSuccess(final boolean isValid) {
        if (isValid) {
            //The session is valid, notify the application
            //You may now access the session token using FHAuthSession.getToken()
        } else {
            //The session is not valid. Clear the application's
            //state and authenticate again
          }
}


      @Override
      public void handleError(FHResponse resp) {
         //Something went wrong with the network call.
      }
  }, false);


} else {
    //Not logged in, notify the application.
}</programlisting>
</para>
</formalpara>
<simpara>Use <literal>FHAuthSession.clear(boolean synchronous)</literal> to log the client out of the platform. Note that this method performs network access. If it is called from the main looper, set the <literal>synchronous</literal> argument to <literal>false</literal> to prevent the network operation from blocking the looper thread and causing Android to throw a <literal>NetworkOnMainThreadException</literal>.</simpara>
<programlisting language="java" linenumbering="unnumbered">FHAuthSession.clear(false);</programlisting>
<programlisting language="objectivec" linenumbering="unnumbered">//To check if user is already authenticated
BOOL hasSession = [FH hasAuthSession];
if(hasSession) {
//optionally we can also verify the session is acutally valid from client. This requires network connection.
[FH verifyAuthSessionWithSuccess:nil AndFailure:nil];
}
//When the user is logging out, the session should be cleared
[FH clearAuthSessionWithSuccess:nil AndFailure:nil];</programlisting>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">//To check if user is already authenticated
FHAuthSession session = FH.GetAuthSession();
Boolean exists = session.Exists();
//optionally we can also verify the session is actually valid from client. This requires network connection.
if(exists) {
  bool valid = await session.Verify();
}

//When the user is logging out, the session should be cleared
session.Clear();</programlisting>
</para>
</formalpara>
<simpara>There is also a middleware provided in the fh-mbaas-api module to validate the <literal>sessionToken</literal> in the requests. This will make it a lot easier to see if a request is from an authenticated user. All you have to do is something like this:</simpara>
<programlisting language="javascript" linenumbering="unnumbered">var mbaasExpress = require('fh-mbaas-api').mbaasExpress();
var express = require('express');
var router = new express.Router();
//This will protect the router and only accept requests from authenticated users.
//If a sessionToken is valid, you can choose to cache it so that it doesn't need to be checked again.
router.use(mbaasExpress.fhauth({cache: true, expire: 60*60}));</programlisting>
</section>
<section xml:id="create-your-own-authentication-providers">
<title>Create your own authentication providers</title>
<simpara>With the introduction of <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/product-features/#auth-policies">mBaaS auth policy type</link>, you can now create your own authenticate providers.</simpara>
<simpara>All you have to do is to create a <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/product-features/#mbaas-services">mBaaS service</link> that will:</simpara>
<itemizedlist>
<listitem>
<simpara>perform the authentication</simpara>
</listitem>
<listitem>
<simpara>return a JSON response containing a <literal>sessionToken</literal> key</simpara>
</listitem>
</itemizedlist>
<simpara>As described above, the <literal>sessionToken</literal> will then be added to all the cloud calls by the client SDK (via a header called <literal>X-FH-SESSIONTOKEN</literal>). However, since the <literal>sessionToken</literal> is generated by the mBaaS service, the session valdiation middleware provided in fh-mbaas-api will not work anymore. You need to provide your own middleware to verify the value of <literal>sessionToken</literal>. But it also means you can add more information to the requests during the validation process, for example, populate user information into the request objects as well.</simpara>
</section>
</chapter>
<chapter xml:id="fh-cloud">
<title>$fh.cloud</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.cloud(options, success, failure);</programlisting>
<simpara>Call <emphasis>ANY</emphasis> cloud URLs which you have defined in the Cloud App using AJAX.
For example, if you are using Express to defined endpoints in your Cloud Apps, you should use this API instead of $fh.act.</simpara>
<itemizedlist xml:id="cloud-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="cloud-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">$fh.cloud({
  "path": "/api/v1/user/create", //only the path part of the url, the host will be added automatically
  "method": "POST", //all other HTTP methods are supported as well. For example, HEAD, DELETE, OPTIONS
  "contentType": "application/json",
  "data": { "username": "testuser"}, //data to send to the server
  "timeout": 25000 // timeout value specified in milliseconds. Default: 60000 (60s)
}, function(res) {
  // Cloud call was successful. Alert the response
  alert('Got response from cloud:' + JSON.stringify(res));
}, function(msg,err) {
  // An error occurred during the cloud call. Alert some debugging information
  alert('Cloud call failed with error message:' + msg + '. Error properties:' + JSON.stringify(err));
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">//build the request object with request path, method, headers and data
Header[] headers = new Header[1];
headers[0] = new BasicHeader("contentType", "application/json");
//The request should have a timeout of 25 seconds, 10 is the default
FHHttpClient.setTimeout(25000);
FHCloudRequest request = FH.buildCloudRequest("/api/v1/user/create", "POST", headers, new JSONObject().put("username", "testuser"));
//the request will be executed asynchronously
request.executeAsync(new FHActCallback() {
  @Override
  public void success(FHResponse res) {
    //the function to execute if the request is successful
    try{
      //process response data
    } catch(Exception e){
      Log.e(TAG, e.getMessage(), e);
    }
  }

  @Override
  public void fail(FHResponse res) {
    //the function to execute if the request is failed
    Log.e(TAG, res.getErrorMessage(), res.getError());
  }
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">NSDictionary * headers = [NSDictionary dictionaryWithObject:@"application/json" forKey:@"contentType"];
  NSDictionary * data = [NSDictionary dictionaryWithObject:@"testuser" forKey:@"username"];
  FHCloudRequest * action = (FHCloudRequest *) [FH buildCloudRequest:@"/api/v1/user/create" WithMethod:@"POST" AndHeaders:headers AndArgs:data];
  // change timeout (default value: 60s)
  action.requestTimeout = 25.0;
  [action execAsyncWithSuccess:^(FHResponse * actRes){
    //the actRes will contain 10 tweets about "feedhenry"
    //the JSON response from the cloud will be parsed to NSDictionary automatically
    NSDictionary * resData = actRes.parsedResponse;
    // ...
  } AndFailure:^(FHResponse * actFailRes){
    //if there is any error, you can check the rawResponse string
    NSLog(@"Failed to read tweets. Response = %@", actFailRes.rawResponse);
  }
];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">        let args = ["key1": "value1", "key2": "value2"] as [String : AnyObject]
        FH.cloud(path: "/path",
                 method: HTTPMethod.POST,
                 args: args,
                 completionHandler: {(resp: Response, error: NSError?) -&gt; Void in
                    if error != nil {
                        print("Cloud Call Failed: " + (error?.localizedDescription)!)
                        return
                    }
                    if let parsedRes = resp.parsedResponse as? [String:String] {
                        print("Success: " + parsedRes["jsonKey"]!)
                    }
        })</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">var headers = new Dictionary&lt;string, string&gt;; {{"contentType", "application/json"}};
var data = new Dictionary&lt;string, object&gt; {{"username", "testuser"}};

//change the timeout to 60 seconds, default is 30 seconds
FH.TimeOut = TimeSpan.FromSeconds(60);
var response = await FH.Cloud("/api/v1/user/create", "POST", headers, data);
if(null == response.Error)
{
    //no error occured, the request is successful
    var rawResponseData = response.RawResponse;
    //you can get it as JSONObject (require Json.Net library)
    var resJson = response.GetResponseAsJObject();
    //process response data
}
else
{
    //error occured during the request, deal with it.
    //More infomation can be access from response.Error.InnerException
}</programlisting>
</para>
</formalpara>
</section>
</chapter>
<chapter xml:id="fh-getCloudURL">
<title>$fh.getCloudURL</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.getCloudURL();</programlisting>
<simpara>Get the URL of the Cloud App that the current Client App is communicating with. Should only be used after the SDK is initialized.</simpara>
<simpara>Once you have the URL of the Cloud App, you can use any other HTTP/AJAX client to communicate with the Cloud App. However, the downside of this approach is that your app won’t be able to use the analytics service provided by the platform as some meta data is missing in the requests, or if the endpoints are secured, you will not be able to call them without providing the API keys.</simpara>
<simpara>To make it easier, the SDKs also have APIs to provide this meta data as request parameters or headers. You just need to get the data and add it to the requests either as part of the request body or request headers. See <link linkend="fh-getFHParams">$fh.getFHParams</link>.</simpara>
<itemizedlist xml:id="cloud-app-url-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="cloud-app-url-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var cloud_url = $fh.getCloudURL();</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">String cloudAppHost = FH.getCloudHost();</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">NSString * cloudAppHost = [FH getCloudHost];</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string cloudAppHost = FH.GetCloudHost();</programlisting>
</para>
</formalpara>
</section>
</chapter>
<chapter xml:id="fh-getFHParams">
<title>$fh.getFHParams</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.getFHParams();</programlisting>
<simpara>This method will return the meta data added by the FH SDK for each cloud request. If you choose to use another library to communicate with the Cloud App, you should add this data to the request body or as headers. To get the Cloud App url, see <link linkend="fh-getCloudURL">$fh.getCloudURL</link>.</simpara>
<simpara>Normally, you don’t need to modify the meta data at all. But if you are interested, the meta data includes the following keys and values:</simpara>
<itemizedlist>
<listitem>
<simpara>appid: the id of the app</simpara>
</listitem>
<listitem>
<simpara>appkey: the api key of the app</simpara>
</listitem>
<listitem>
<simpara>projectid: the id of the project</simpara>
</listitem>
<listitem>
<simpara>cuid: a unique id genereated for the client</simpara>
</listitem>
<listitem>
<simpara>destination: the platform the Client App is running on. For example, iOS, Android, Web</simpara>
</listitem>
<listitem>
<simpara>sdk_version: the version of the sdk</simpara>
</listitem>
<listitem>
<simpara>connectiontag: connectiontag for the app</simpara>
</listitem>
</itemizedlist>
<simpara>If the meta data is sent in the request body, it should be the value of a special key called "__fh". See example below.</simpara>
<simpara>Some SDKs can provide this meta data as request headers. In this case, the name of each header will be like "X-FH-&lt;meta data name&gt;", for example, "X-FH-appid".</simpara>
<itemizedlist xml:id="default-params-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="default-params-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var fhparams = $fh.getFHParams();
//then it should be added to your request body under the key "__fh"
body.__fh = fhparams;</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>To get the request meta data as a JSON object:</para>
</formalpara>
<programlisting language="java" linenumbering="unnumbered">JSONObject fhParams = FH.getDefaultParams();</programlisting>
<simpara>You can get the meta data as HTTP headers as well:</simpara>
<programlisting language="java" linenumbering="unnumbered">Header[] fhParamHeaders = FH.getDefaultParamsAsHeaders(null);</programlisting>
<formalpara>
<title>iOS (Objective-C)</title>
<para>To get the request meta data as a NSDictionary:</para>
</formalpara>
<programlisting language="objectivec" linenumbering="unnumbered">NSDictionary * fhParams = [FH getDefaultParams];</programlisting>
<simpara>You can get the meta data as HTTP headers in a NSDictionary:</simpara>
<programlisting language="objectivec" linenumbering="unnumbered">NSDictionary * fhParamHeaders = [FH getDefaultParamsAsHeaders];</programlisting>
<formalpara>
<title> .NET (C#)</title>
<para>To get the request meta data as a Dictionary:</para>
</formalpara>
<programlisting language="csharp" linenumbering="unnumbered">  IDictionary &lt;string, object&gt; fhParams = FH.GetDefaultParams();</programlisting>
<simpara>You can get the meta data as HTTP headers in a Dictionary:</simpara>
<programlisting language="csharp" linenumbering="unnumbered">IDictionary &lt;string, string&gt; fhParamHeaders = FH.GetDefaultParamsAsHeaders();</programlisting>
</section>
</chapter>
<chapter xml:id="fh-forms">
<title>$fh.forms</title>
<simpara>To use <literal>$fh.forms</literal>, you must initialize it using <literal>$fh.forms.init</literal>.
However, to use <literal>$fh.forms.init</literal>, you must call <literal>$fh.init</literal>.</simpara>
<important>
<simpara><literal>$fh.init</literal> must complete before using <literal>$fh.forms.init</literal>. For more information, see <link linkend="fh-init">fh-init</link>.</simpara>
</important>
<itemizedlist xml:id="forms-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="sdk-structure">
<title>SDK Structure</title>
<section xml:id="core">
<title>Core</title>
<simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/shared/images/forms_core_structure.png"/>
</imageobject>
<textobject><phrase>Core Structure</phrase></textobject>
</inlinemediaobject></simpara>
</section>
</section>
<section xml:id="fh-forms-init">
<title>$fh.forms.init</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.init(params, callback);</programlisting>
<section xml:id="forms-details">
<title>Details</title>
<simpara>Initialise appForm SDK. Currently the params is not used so pass in empty JSON object. callback will be called when initialisation finished.</simpara>
</section>
<section xml:id="forms-example">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {};
$fh.forms.init(params, function(err) {
  if (err) console.error(err);

  // Forms initialised ok if no error
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-getforms">
<title>$fh.forms.getForms</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.getForms(params, callback);</programlisting>
<section xml:id="forms-details-1">
<title>Details</title>
<simpara>Retrieves an array of Form models. Can be loaded from the server if the 'fromRemote' parameter is set to true, or from local storage if set to false.</simpara>
</section>
<section xml:id="forms-example-1">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
 "fromRemote": true
};

$fh.forms.getForms(params, function(err, forms){
  if(err) console.error(err);

  // forms is an instance of $fh.forms.models.forms
  // See Models section for details of its API
  // for example, getFormsList() returns an array of Forms models

  var formsList = forms.getFormsList();
  console.log(formsList);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-getform">
<title>$fh.forms.getForm</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.getForm(params, callback);</programlisting>
<section xml:id="forms-details-2">
<title>Details</title>
<simpara>Retrieves a form based on a specified ID.</simpara>
</section>
<section xml:id="forms-example-2">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
 "fromRemote" : true,
 "formId" : "1234"
};

$fh.forms.getForm(params, function(err, form){
if(err) console.error(err);

var formName = form.getName();
var formDesc = form.getDescription();
console.log('Form Name: ', formName, 'Form Desc: ', formDesc);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-gettheme">
<title>$fh.forms.getTheme</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.getTheme(params, callback);</programlisting>
<section xml:id="forms-details-3">
<title>Details</title>
<simpara>Retrieves a theme. If the 'css' parameter is set to true, css is returned. If it is set to false, a Theme object is returned.</simpara>
</section>
<section xml:id="forms-example-3">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
 "css" : true //if set to true, returns css.
};

$fh.forms.getTheme(params, function(err, theme){
if(err) console.error(err);

console.log(theme);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-getsubmissions">
<title>$fh.forms.getSubmissions</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.getSubmissions(options, callback);</programlisting>
<section xml:id="forms-details-4">
<title>Details</title>
<simpara>Returns a list of submissions that have been successfully completed.</simpara>
</section>
<section xml:id="forms-example-4">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {};

$fh.forms.getSubmissions(params, function (err, submissions) {
  if (err) console.error(err);

  console.log('Array of completed submissions', submissions);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-downloadsubmission">
<title>$fh.forms.downloadSubmission</title>
<section xml:id="forms-details-5">
<title>Details</title>
<simpara>Triggers the download of a submission.</simpara>
<simpara>There are two forms of this API.</simpara>
</section>
<section xml:id="example-callback-passed">
<title>Example: Callback Passed</title>
<simpara>In this example, passing a callback to the <emphasis>$fh.forms.downloadSubmission</emphasis> function means that the callback will only be called when the submission, including all files, has fully completed downloading.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  'submissionId': "&lt;&lt; ID of the submission stored in the cloud &gt;&gt;"
};

//Downloading the submission.
//If the submission has already been downloaded to local memory, it will be loaded from there instead of downloading from the cloud.
$fh.forms.downloadSubmission(params, function(err, downloadedSubmission){
  if(err){
    return console.error(err);
  }

  //The form that the submission was submitted against is sent back with the submission from the cloud.
  var formSubmittedAgainst = downloadedSubmission.getFormSubmittedAgainst();
  var formId = downloadedSubmission.getFormId();
});</programlisting>
</section>
<section xml:id="example-callback-not-passed">
<title>Example: Callback Not Passed</title>
<simpara>In this example, not passing a callback will queue the submission for download. Global event listeners can then be used to monitor the download progress.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  'submissionId': "&lt;&lt; ID of the submission stored in the cloud &gt;&gt;"
};

//A global event listener for all submission 'downloaded' events
$fh.forms.on('submission:downloaded', function(remoteSubmissionId){
  //The form that the submission was submitted against is sent back with the submission from the cloud.
  var formSubmittedAgainst = this.getFormSubmittedAgainst();
  var formId = this.getFormId();
});

//A global event listener for all submission 'error' events
$fh.forms.on('submission:error', function(errorMessage){
  var localId = this.getLocalId();

  console.error(errorMessage + " for submission with local ID " + localId);
});

//Downloading the submission.
//If the submission has already been downloaded to local memory, it will be loaded from there instead of downloading from the cloud.
$fh.forms.downloadSubmission(params);</programlisting>
</section>
</section>
<section xml:id="fh-forms-log">
<title>$fh.forms.log</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.log.e(message); //logs an error
$fh.forms.log.w(message); //logs a warning
$fh.forms.log.d(message); //logs a debug message
$fh.forms.log.l(message); //logs success</programlisting>
<section xml:id="forms-details-6">
<title>Details</title>
<simpara>There are 4 types of logs:</simpara>
<itemizedlist>
<listitem>
<simpara>Error: $fh.forms.log.e('error');</simpara>
</listitem>
<listitem>
<simpara>Warning: $fh.forms.log.w('warning');</simpara>
</listitem>
<listitem>
<simpara>Debug: $fh.forms.log.d('debug');</simpara>
</listitem>
<listitem>
<simpara>Log: $fh.forms.log.l('successful log');</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="forms-example-5">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
 'fromRemote' : true
};

$fh.forms.getForms(params, function(err, formsList){
if(error) $fh.forms.log.e(err); //log error

console.log('Lit of forms: ', formsList.getFormsList());
  $fh.forms.log.l('Forms loaded successfully'); //log successfuly loading of forms
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-getlogs">
<title>$fh.forms.getLogs</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.log.getLogs();</programlisting>
<section xml:id="forms-details-7">
<title>Details</title>
<simpara>Returns log information.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.getSubmissions({}, function (err, submissions) {
  if (err) {
    console.log('Error loading submissions', err);
  } else {
    $fh.forms.log.l('Array loaded successfully') //Recorded log
    console.log('Array of completed submissions', submissions);


    var logRecords = $fh.forms.log.getLogs();
    console.log('Log Record', logRecords); //Prints out an array of all logs
  }
});</programlisting>
</section>
</section>
<section xml:id="global-events">
<title>Global Events</title>
<section xml:id="forms-details-8">
<title>Details</title>
<simpara>The $fh.forms API provides a global event emitter for all events that occur in the $fh.forms API.</simpara>
<simpara>The event name is defined in the format <literal>model:eventname</literal>. For example, if the <literal>Submission</literal> model emits the <literal>submitted</literal> event, the global event name would be <literal>submission:submitted</literal>. This event would fire whenever any submissions has been submitted and uploaded.</simpara>
</section>
<section xml:id="fh-forms-on">
<title>$fh.forms.on</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.on("submission:progress", function(progressJSON) {
    //See Submission Model Progress For progressJSON Definition
});</programlisting>
</section>
<section xml:id="fh-forms-once">
<title>$fh.forms.once</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.once("submission:submitted", function(submissionId) {
    //Note: this refers to the individual submission that emitted the submitted event.
    assert.equal(this.getRemoteSubmissionId(), submissionId);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms">
<title>$fh.forms.models.forms</title>
<section xml:id="forms-details-9">
<title>Details</title>
<simpara>This is a list of Form models returned by $fh.forms.getForms(). The functions listed below can be called on the returned Form Models array.</simpara>
</section>
<section xml:id="fh-forms-models-forms-clearallforms">
<title>$fh.forms.models.forms.clearAllForms</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.clearAllForms(cb);</programlisting>
<section xml:id="forms-details-10">
<title>Details</title>
<simpara>Clear all local forms.</simpara>
<note>
<simpara>This function is currently being implemented</simpara>
</note>
</section>
<section xml:id="forms-example-6">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">formsList.clearAllForms(function(err) {
    if (err) {
        console.log('Error deleting forms', err);
    } else {
        console.log('Reloading forms list', formsList.getFormsList()); //will return empty list
    }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms-isformupdated">
<title>$fh.forms.models.forms.isFormUpdated</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.isFormUpdated(formModel);</programlisting>
<section xml:id="forms-details-11">
<title>Details</title>
<simpara>Check if a specific form model is up to date.</simpara>
</section>
<section xml:id="forms-example-7">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var model = new $fh.forms.models.Form();
var updated = $fh.forms.models.forms.isFormUpdated(model);
console.log(updated);</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms-getformmetabyid">
<title>$fh.forms.models.forms.getFormMetaById</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.getFormMetaById(formId)</programlisting>
<section xml:id="forms-details-12">
<title>Details</title>
<simpara>Get form meta object by formId.</simpara>
</section>
<section xml:id="forms-example-8">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var exampleFormId = '1234';

var params = {
 'fromRemote' : true
};

$fh.forms.getForms(params, function(err, formsList){
if(err) console.error(err);

var formDetails = formsList.getFormMetaById(exampleFormId); //gets meta object from forms list based on id
console.log(formDetails);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms-refresh">
<title>$fh.forms.models.forms.refresh</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.refresh(fromRemote, cb);</programlisting>
<section xml:id="forms-details-13">
<title>Details</title>
<simpara>Read form list model from local or remote forcely. It will store to local storage automatically if it does not exist.</simpara>
</section>
<section xml:id="forms-example-9">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">formsList.refresh(true, function (err) { //if fromRemote == true, forms are read from server.
// If false, reads from local storage
  if (err) {
    console.log('Error refreshing form', err);
  } else {
    console.log('Refreshed form list', formsList); //prints newly refrehsed list
  }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms-clearlocal">
<title>$fh.forms.models.forms.clearLocal</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.clearLocal(cb);</programlisting>
<section xml:id="forms-details-14">
<title>Details</title>
<simpara>Removes model from local storage but not from RAM.</simpara>
</section>
<section xml:id="forms-example-10">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">formsList.clearLocal(function (err) {
  if (err) {
    console.log('Error occurred clearing forms from local storage', err);
  } else {
    console.log('Reloading forms', formsList.getFormsList());
  }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms-getformslist">
<title>$fh.forms.models.forms.getFormsList</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.getFormsList();</programlisting>
<section xml:id="forms-details-15">
<title>Details</title>
<simpara>Retrieve an array containing forms meta data.</simpara>
</section>
<section xml:id="forms-example-11">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  'fromRemote': true
};

$fh.forms.getForms(params, function (err, formsList) {
  if (err) console.error(err);

  var forms = formsList.getFormsList();
  console.log(forms);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-forms-size">
<title>$fh.forms.models.forms.size</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.forms.size();</programlisting>
<section xml:id="forms-details-16">
<title>Details</title>
<simpara>Retrieve the number of forms stored.</simpara>
</section>
<section xml:id="forms-example-12">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "fromRemote": true
};

$fh.forms.getForms(params, function (err, formsList) {
  if (err) console.error.(err);

  var numOfForms = formsList.size();
  console.log(numOfForms);
});</programlisting>
</section>
</section>
</section>
<section xml:id="fh-forms-models-form">
<title>$fh.forms.models.Form</title>
<section xml:id="forms-details-17">
<title>Details</title>
<simpara>This is a Form model. A list of Form models is returned by calling forms.getFormsList().</simpara>
</section>
<section xml:id="fh-forms-models-form-constructor">
<title>$fh.forms.models.Form.constructor()</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.Form(params,cb);</programlisting>
<section xml:id="forms-details-18">
<title>Details</title>
<simpara>Construct a Form object. Callback when form definition is loaded.</simpara>
</section>
<section xml:id="forms-example-13">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": ”1234”,
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  // new form model
  console.log(form);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-getlastupdate">
<title>$fh.forms.models.Form.getLastUpdate()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getLastUpdate();</programlisting>
<section xml:id="forms-details-19">
<title>Details</title>
<simpara>Retrieve last updated timestamp on server.</simpara>
</section>
<section xml:id="forms-example-14">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": ”1234”,
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var lastUpdate = form.getLastUpdate();
  console.log(lastUpdate);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-getpagemodellist">
<title>$fh.forms.models.Form.getPageModelList()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getPageModelList();</programlisting>
<section xml:id="forms-details-20">
<title>Details</title>
<simpara>Retrieve an array of page models associated to this form.</simpara>
</section>
<section xml:id="forms-example-15">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": "1234",
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var pageList = form.getPageModelList();
  console.log('Array of pages associated with this form', pageList);
});</programlisting>
</section>
<section xml:id="fh-forms-models-form-getruleengine">
<title>fh.forms.models.Form.getRuleEngine()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getRuleEngine();</programlisting>
</section>
<section xml:id="forms-details-21">
<title>Details</title>
<simpara>Retrieve rule engine attached to the form().</simpara>
</section>
<section xml:id="forms-example-16">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": 1234,
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var ruleEngine = form.getRuleEngine();
  console.log(ruleEngine);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-getname">
<title>$fh.forms.models.Form.getName()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getName();</programlisting>
<section xml:id="forms-details-22">
<title>Details</title>
<simpara>Retrieve form name.</simpara>
</section>
<section xml:id="forms-example-17">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": "1234",
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var formName = form.getName();
  console.log(formName);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-getdescription">
<title>$fh.forms.models.Form.getDescription()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getDescription();</programlisting>
<section xml:id="forms-details-23">
<title>Details</title>
<simpara>Retrieve form description.</simpara>
</section>
<section xml:id="forms-example-18">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": "1234",
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var formDescription = form.getDescription();
  console.log(formDescription);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-getformid">
<title>$fh.forms.models.Form.getFormId()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getFormId();</programlisting>
<section xml:id="forms-details-24">
<title>Details</title>
<simpara>Retrieve form Id.</simpara>
</section>
<section xml:id="forms-example-19">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": "1234",
  "fromRemote": true
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var formId = form.getId();
  console.log(formId);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-getfieldmodelbyid">
<title>$fh.forms.models.Form.getFieldModelById()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.getFieldModelById(fieldId);</programlisting>
<section xml:id="forms-details-25">
<title>Details</title>
<simpara>Retrieve field model by field id.</simpara>
</section>
<section xml:id="forms-example-20">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
  "formId": "1234",
  "fromRemote": true,
  "fieldId": "123"
};

$fh.forms.getForm(params, function (err, form) {
  if (err) console.error(err);

  var fieldModel = form.getFieldModelById(fieldId);
  console.log(fieldModel);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-newsubmission">
<title>$fh.forms.models.Form.newSubmission()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.newSubmission();</programlisting>
<section xml:id="forms-details-26">
<title>Details</title>
<simpara>Initialise a new submission model for this form.</simpara>
</section>
<section xml:id="forms-example-21">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">form.newSubmission(); //creates a new submission</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-removefromcache">
<title>$fh.forms.models.Form.removeFromCache()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.removeFromCache();</programlisting>
<section xml:id="forms-details-27">
<title>Details</title>
<simpara>Remove current form model from memory cache (singleton).</simpara>
</section>
<section xml:id="forms-example-22">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">form.removeFromCache();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-refresh">
<title>$fh.forms.models.Form.refresh()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.refresh([fromRemote], cb);</programlisting>
<section xml:id="forms-details-28">
<title>Details</title>
<simpara>Read form model from local memory or remote forcely. It will sotre to local storage automatically if it does not exist.</simpara>
</section>
<section xml:id="forms-example-23">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">form.refresh(true, function (err) {
  if (err) {
    console.log('Error refreshing', err);
  } else {
    console.log('Refreshed page');
    //refresh successful
  }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-form-clearlocal">
<title>$fh.forms.models.Form.clearLocal()</title>
<programlisting language="javascript" linenumbering="unnumbered">form.clearLocal(cb)</programlisting>
<section xml:id="forms-details-29">
<title>Details</title>
<simpara>Remove locally stored Form.</simpara>
</section>
<section xml:id="forms-example-24">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">foundForm.clearLocal(function (err) {
  if (err) {
   console.log('Error removing form');
  } else {
   //form cleared successfully
  }
});</programlisting>
</section>
</section>
</section>
<section xml:id="fh-forms-models-page">
<title>$fh.forms.models.Page</title>
<section xml:id="forms-details-30">
<title>Details</title>
<simpara>Listed below are the functions that can be called on a Page model.</simpara>
</section>
<section xml:id="fh-forms-models-page-setvisible">
<title>$fh.forms.models.Page.setVisible()</title>
<programlisting language="javascript" linenumbering="unnumbered">page.setVisible(isVisible);</programlisting>
<section xml:id="forms-details-31">
<title>Details</title>
<simpara>Set if this page model should be visible or not. Will emit ‘visible’ or ‘hidden’ based on whether the boolean value 'isVisible'
is set to true or false.</simpara>
</section>
<section xml:id="forms-example-25">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">page.setVisible(true) //Boolean value to determine whether page is set to visible or not.</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-page-getname">
<title>$fh.forms.models.Page.getName()</title>
<programlisting language="javascript" linenumbering="unnumbered">page.getName();</programlisting>
<section xml:id="forms-details-32">
<title>Details</title>
<simpara>Retrieves page name.</simpara>
</section>
<section xml:id="forms-example-26">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered"> var pageList = foundForm.getPageModelList(); //Iterates through all pages of a returned form and prints out page names
 for (var page = 0; page &lt; pageList.length; page++) {
   var currentPage = pageList[page];
   console.log('Name of current page is: ', currentPage.getName());
 }</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-page-getdescription">
<title>$fh.forms.models.Page.getDescription()</title>
<programlisting language="javascript" linenumbering="unnumbered">page.getDescription();</programlisting>
<section xml:id="description">
<title>Description</title>
<simpara>Retrieve page description.</simpara>
</section>
<section xml:id="forms-example-27">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">page.getDescription();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-page-getfieldmodellist">
<title>$fh.forms.models.Page.getFieldModelList()</title>
<programlisting language="javascript" linenumbering="unnumbered">page.getFieldModelList();</programlisting>
<section xml:id="forms-details-33">
<title>Details</title>
<simpara>Retrieve field models associated to this page.</simpara>
</section>
<section xml:id="forms-example-28">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var pageList = form.getPageModelList(); //Retrieves all pages of a form

for (var page = 0; page &lt; pageList.length; page++) { //Iterates through all pages
  var currentPage = pageList[page];
  var pageFields = currentPage.getFieldModelList(); //Retrieves all fields on a page
  console.log(pageFields); //Lists all fields
}</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-page-getfieldmodelbyid">
<title>$fh.forms.models.Page.getFieldModelById()</title>
<programlisting language="javascript" linenumbering="unnumbered">page.getFieldModelById(fieldId);</programlisting>
<section xml:id="forms-details-34">
<title>Details</title>
<simpara>Retrieve a specific field model. The field model does not need to be in this page. Alias of Form.getFieldModelById(fieldId).</simpara>
</section>
<section xml:id="forms-example-29">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var fieldId = '1234';

page.getFieldModelById(fieldId); //Returns Field model</programlisting>
</section>
</section>
</section>
<section xml:id="fh-forms-models-field">
<title>$fh.forms.models.Field</title>
<section xml:id="forms-details-35">
<title>Details</title>
<simpara>A list of Field objects can be returned by calling the getFieldModelList() function on a Page model.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">pageOne.getFieldModelList();</programlisting>
<simpara>Listed below are a set of functions that can be called to access various attributes of a Field model.</simpara>
</section>
<section xml:id="fh-forms-models-field-isrequired">
<title>$fh.forms.models.Field.isRequired()</title>
<programlisting language="javascript" linenumbering="unnumbered">currentField.isRequired();</programlisting>
<section xml:id="forms-details-36">
<title>Details</title>
<simpara>Returns true if the field is a required field.</simpara>
</section>
<section xml:id="forms-example-30">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">currentField.isRequired(); //will return true if the field is required</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-isrepeating">
<title>$fh.forms.models.Field.isRepeating()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.isRepeating();</programlisting>
<section xml:id="forms-details-37">
<title>Details</title>
<simpara>Returns true if the field is a repeating field, or false if the field is not a repeating field.</simpara>
</section>
<section xml:id="forms-example-31">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">field.isRepeating();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-gettype">
<title>$fh.forms.models.Field.getType()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getType();</programlisting>
<section xml:id="forms-details-38">
<title>Details</title>
<simpara>Returns the type of the field.</simpara>
</section>
<section xml:id="forms-example-32">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getType();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-getname">
<title>$fh.forms.models.Field.getName()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getName();</programlisting>
<section xml:id="forms-details-39">
<title>Details</title>
<simpara>Returns the name of the field.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">console.log(field.getName()); //pritns name of field</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-getcode">
<title>$fh.forms.models.Field.getCode()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getCode();</programlisting>
<section xml:id="forms-details-40">
<title>Details</title>
<simpara>Returns the Field Code for a field if it exists. If the field was not assigned a field code in the Studio <literal>null</literal> is returned.</simpara>
</section>
</section>
<section xml:id="fh-forms-models-field-gethelptext">
<title>$fh.forms.models.Field.getHelpText()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getHelpText();</programlisting>
<section xml:id="forms-details-41">
<title>Details</title>
<simpara>Returns field instruction text.</simpara>
</section>
<section xml:id="forms-example-33">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getHelpText();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-validateinputvalue">
<title>$fh.forms.models.Field.validate(inputValue)</title>
<programlisting language="javascript" linenumbering="unnumbered">field.validate(inputValue, callback(err,res))</programlisting>
<section xml:id="forms-details-42">
<title>Details</title>
<simpara>Returns the inputValue object if validation is successful, or an error message if validation fails.</simpara>
</section>
<section xml:id="forms-example-34">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var field = form.getFieldModelById(fieldId);
var inputValue = elem.value; //Value of an element such as text field, numberfield etc

field.validate(inputValue, function (err, res) {
  if (err) {
    console.log('Validation Error', err);
  } else {
    console.log('Validation Successful', res);
  }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-getrules">
<title>$fh.forms.models.Field.getRules()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getRules();</programlisting>
<section xml:id="forms-details-43">
<title>Details</title>
<simpara>Returns an array of rule objects that are associated with the field.</simpara>
</section>
<section xml:id="forms-example-35">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getRules();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-getcheckboxoptions">
<title>$fh.forms.models.Field.getCheckboxOptions()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getCheckboxOptions();</programlisting>
<section xml:id="forms-details-44">
<title>Details</title>
<simpara>Retuns an array of check box choices.</simpara>
<note>
<simpara>Only valid for check boxes field</simpara>
</note>
</section>
<section xml:id="forms-example-36">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">if (field.getType() == 'checkboxes') {
  console.log('Checkbox options: ', field.getCheckBoxOptions());
}</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-field-getradiooption">
<title>$fh.forms.models.Field.getRadioOption()</title>
<programlisting language="javascript" linenumbering="unnumbered">field.getRadioOption();</programlisting>
<section xml:id="forms-details-45">
<title>Details</title>
<simpara>Returns radio box options.</simpara>
<note>
<simpara>Only valid for radio field</simpara>
</note>
</section>
<section xml:id="forms-example-37">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">if (field.getType() == 'radio') {
  console.log('Radio options: ', field.getRadioOption());
}</programlisting>
</section>
</section>
</section>
<section xml:id="fh-forms-models-submissions">
<title>$fh.forms.models.submissions</title>
<section xml:id="fh-forms-models-submissions-getsubmissions">
<title>$fh.forms.models.submissions.getSubmissions()</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.submissions.getSubmissions();</programlisting>
<section xml:id="forms-details-46">
<title>Details</title>
<simpara>Returns a list of submission meta data.</simpara>
</section>
<section xml:id="forms-example-38">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmissions();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getsubmissionmetalist">
<title>$fh.forms.models.submissions.getSubmissionMetaList()</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmissionMetaList();</programlisting>
<section xml:id="forms-details-47">
<title>Details</title>
<simpara>Returns a list of submission meta data</simpara>
</section>
<section xml:id="forms-example-39">
<title>Example</title>
<simpara>submissions.getSubmissionMetaList();</simpara>
</section>
</section>
<section xml:id="fh-forms-models-submissions-findbyformidformid">
<title>$fh.forms.models.submissions.findByFormId(formId)</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.findByFormId(formId);</programlisting>
<section xml:id="forms-details-48">
<title>Details</title>
<simpara>Retrieves the meta data for specified form.</simpara>
</section>
<section xml:id="forms-example-40">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var formId = '53146bf95a133733451cd35b';

$fh.forms.getSubmissions({}, function (err, submissions) {
  if (err) {
    console.log('Error loading submissions', err);
  } else {
    console.log('Array of completed submissions', submissions);
    var foundSubmissions = submissions.findByFormId(formId);
    console.log('Array of submissions for specified form: ', foundSubmissions);

  }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-clearcb">
<title>$fh.forms.models.submissions.clear(cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">sumissions.clear(function(err))</programlisting>
<section xml:id="forms-details-49">
<title>Details</title>
<simpara>Clear submission meta list from this model and local storage.</simpara>
</section>
<section xml:id="forms-example-41">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.getSubmissions({}, function(err, submissions) {
    if (err) {
        console.log('Error loading submissions', err);
    } else {
        console.log('Array of completed submissions', submissions);
        submissions.clear(function(err) {
            if (err) console.err(err);
        });
    }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getdrafts">
<title>$fh.forms.models.submissions.getDrafts()</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getDrafts()</programlisting>
<section xml:id="forms-details-50">
<title>Details</title>
<simpara>Return submission drafts()</simpara>
</section>
<section xml:id="forms-example-42">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getDrafts();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getpending">
<title>$fh.forms.models.submissions.getPending()</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getPending()</programlisting>
<section xml:id="forms-details-51">
<title>Details</title>
<simpara>Returns pending submissions.</simpara>
</section>
<section xml:id="forms-example-43">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getPending();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getsubmitted">
<title>$fh.forms.models.submissions.getSubmitted()</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmitted()</programlisting>
<section xml:id="forms-details-52">
<title>Details</title>
<simpara>Returns submitted submissions.</simpara>
</section>
<section xml:id="forms-example-44">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmitted();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-geterror">
<title>$fh.forms.models.submissions.getError()</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getError()</programlisting>
<section xml:id="forms-details-53">
<title>Details</title>
<simpara>Returns submissions that have errors.</simpara>
</section>
<section xml:id="forms-example-45">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getError();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getinprogress">
<title>$fh.forms.models.submissions.getInProgress()</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getInProgress()</programlisting>
<section xml:id="forms-details-54">
<title>Details</title>
<simpara>Return submissions that are currently in progress.</simpara>
</section>
<section xml:id="forms-example-46">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getInProgress();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getsubmissionbymetametacb">
<title>$fh.forms.models.submissions.getSubmissionByMeta(meta,cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmissionByMeta(meta, function(err, res))</programlisting>
<section xml:id="forms-details-55">
<title>Details</title>
<simpara>Retrieves a submission model object by submission meta data from submission list model.</simpara>
</section>
<section xml:id="forms-example-47">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = submissions.getSubmitted()[0];

submissions.getSubmissionByMeta(params, function (err, submission){
  if(err) console.error(err);

  console.log('Returned Submission',submission);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getsubmissionbylocalidlocalidcb">
<title>$fh.forms.models.submissions.getSubmissionByLocalId(localId,cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmissionByLocalId(localId, function(err, submissionModel){})</programlisting>
<section xml:id="forms-details-56">
<title>Details</title>
<simpara>Retrieves a submission model by the <emphasis>Local ID</emphasis> of the submission.</simpara>
</section>
<section xml:id="forms-example-48">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var localId = "sublocalid1";

submissions.getSubmissionByLocalId(localId, function (err, submission){
  if(err) console.error(err);

  console.log('Returned Submission',submission);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submissions-getsubmissionbyremoteidremoteidcb">
<title>$fh.forms.models.submissions.getSubmissionByRemoteId(remoteId,cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmissionByRemoteId(remoteId, function(err, submissionModel){})</programlisting>
<section xml:id="forms-details-57">
<title>Details</title>
<simpara>Retrieves a submission model by the <emphasis>Remote ID</emphasis> of the submission.</simpara>
</section>
<section xml:id="forms-example-49">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var remoteId = "subremoteid1";

submissions.getSubmissionByRemoteId(remoteId, function (err, submission){
  if(err) console.error(err);

  console.log('Returned Submission',submission);
}</programlisting>
</section>
</section>
</section>
<section xml:id="fh-forms-models-submission">
<title>$fh.forms.models.Submission</title>
<section xml:id="forms-details-58">
<title>Details</title>
<simpara>Submission models contaon user input and related meta information. A list of Submission models can be returned by calling the .getSubmissions() function on a list of submissions.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">submissions.getSubmissions(); //double check</programlisting>
<simpara>Listed below are functions that can be called on Submission models.</simpara>
</section>
<section xml:id="fh-forms-models-submission-savedraftcb">
<title>$fh.forms.models.Submission.saveDraft(cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.saveDraft(cb);</programlisting>
<section xml:id="forms-details-59">
<title>Details</title>
<simpara>Save current submission to draft / local storage.</simpara>
</section>
<section xml:id="forms-example-50">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">currentSubmission.saveDraft(function (err) {
  if (err) {
    console.log(err);
  } else {
    console.log('Draft saved to local storage');
  }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-submit">
<title>$fh.forms.models.Submission.submit()</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.submit(cb)</programlisting>
<section xml:id="forms-details-60">
<title>Details</title>
<simpara>Submit current submission. It will create a task for uploading.</simpara>
</section>
<section xml:id="forms-example-51">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">currentSubmission.submit(function (err) {
  console.log(!err);
  if (err) {
    console.log(err);
  }
});

currentSubmission.on("submit", function () {
 /* Upload the submission. */
  currentSubmission.upload(function (err) {
    if (err) {
      console.log(err);
    }
  });
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-getstatus">
<title>$fh.forms.models.Submission.getStatus()</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.getStatus();</programlisting>
<section xml:id="forms-details-61">
<title>Details</title>
<simpara>Returns the current status of the submission.</simpara>
</section>
<section xml:id="forms-example-52">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.getStatus();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-addcomment">
<title>$fh.forms.models.Submission.addComment()</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.addComment(message, [username]);</programlisting>
<section xml:id="forms-details-62">
<title>Details</title>
<simpara>Allows a user to add a comment to the current submission.</simpara>
</section>
<section xml:id="forms-example-53">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.addComment('test message', 'test user');</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-getcomments">
<title>$fh.forms.models.Submission.getComments()</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.getComments()</programlisting>
<section xml:id="forms-details-63">
<title>Details</title>
<simpara>Returns an array of commetns for the current submission.</simpara>
</section>
<section xml:id="forms-example-54">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.addComment('test message', 'test user');

console.log(submission.getComments()); //will return an array containing the above comment</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-removecommenttimestamp">
<title>$fh.forms.models.Submission.removeComment(timeStamp)</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.removeComment(timeStamp);</programlisting>
<section xml:id="forms-details-64">
<title>Details</title>
<simpara>Remove a comment from the current submission via its timestamp.</simpara>
</section>
<section xml:id="forms-example-55">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.removeComment(timeStamp);</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-addinputvalueparamscb">
<title>$fh.forms.models.Submission.addInputValue(params,cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.Submission(params, callback(err, res))</programlisting>
<section xml:id="forms-details-65">
<title>Details</title>
<simpara>Add a value to submission for a field. This will validate the input value and it will return an error message as a string if failed.
If in transaction mode, it will not immediately add user input value to submission but a temp variable.
If not in transaction mode, the input value is added to submission immediately.
If the "sectionIndex" parameter is provided, a new value is added to the field in the given section index, within the repeating section group.</simpara>
</section>
<section xml:id="forms-example-56">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var params = {
    "fieldId": '53146c1f04e694ec1ad715b6',
    "value": 'New example text',
  "Index":optional,
    "sectionIndex":optional

};
currentSubmission.addInputValue(params, function(err, res) {
    if (err) console.error(err);

    console.log('Newly added input: ', res);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-startinputtransaction">
<title>$fh.forms.models.Submission.startInputTransaction()</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.startInputTransaction()</programlisting>
<section xml:id="forms-details-66">
<title>Details</title>
<simpara>Start a transaction for user input. if already started, it will drop temporary input.</simpara>
</section>
<section xml:id="forms-example-57">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.startInputTransaction();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-endinputtransactionissucceed">
<title>$fh.forms.models.Submission.endInputTransaction(isSucceed)</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.forms.models.Submission.endInputTransaction(isSucceed) //'isSucceed' is a boolean value.</programlisting>
<section xml:id="forms-details-67">
<title>Details</title>
<simpara>End the transaction. If the transaction succeeds, it will copy temporary input to submission to be uploaded. If it fails, it will drop the temporary user input. 'isSucceed' is
a boolean value. If 'true' is passed into the function, the transaction is complete and the user input is transfered from temporary storage to the submission. If 'false' is
passed into the function, then the temporary values are discarded and the transaction is not completed.</simpara>
</section>
<section xml:id="forms-example-58">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.startInputTransaction();

var params = {
    "fieldId": '53146c1f04e694ec1ad715b6',
    "value": 'Example text'
  };

submission.addInputValue(params, function(err, res) {
    if (err) {
        console.log('Error adding input', err);
        submission.endInputTransaction(false); //Transaction failed. New values are not added to submission.
    } else {
        console.log('Updated value: ', res);
        submission.endInputTransaction(true); //End input transaction. New value is added to submission.
    }
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-reset">
<title>$fh.forms.models.Submission.reset()</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.reset();</programlisting>
<section xml:id="forms-details-68">
<title>Details</title>
<simpara>Remove all user input from this submission.</simpara>
</section>
<section xml:id="forms-example-59">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.reset();</programlisting>
</section>
</section>
<section xml:id="fh-forms-models-submission-getformcb">
<title>$fh.forms.models.Submission.getForm(cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.getForm(function (err, form))</programlisting>
<section xml:id="forms-details-69">
<title>Details</title>
<simpara>Returns Form object associated with the submission.</simpara>
</section>
<section xml:id="forms-example-60">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.getForm(function(err, form) {
    if (err) console.error(err);

    console.log('Form associated with submission: ', form);
});</programlisting>
</section>
</section>
<section xml:id="fh-forms-submission-removefieldvaluefieldid-index">
<title>$fh.forms.Submission.removeFieldValue(fieldId, [index])</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.removeFieldValue(fieldId, index, sectionIndex)
//Index is only specified when referencing repeated fields
//sectionIndex is only specified when referencing repeating section</programlisting>
<section xml:id="forms-details-70">
<title>Details</title>
<simpara>Remove a value from a specific field based on ID, sectionIndex may be passed to get value of a field in specific section, otherwise it defaults to 0.</simpara>
</section>
<section xml:id="forms-example-61">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var exampleFieldId = '1234';

submission.removeFieldValue(exampleFieldId);</programlisting>
</section>
</section>
<section xml:id="fh-forms-submission-getinputvaluebyfieldidfieldcb">
<title>$fh.forms.Submission.getInputValueByFieldId(field,cb)</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.getInputValueByFieldId(field, sectionIndex, function(err, res))</programlisting>
<section xml:id="forms-details-71">
<title>Details</title>
<simpara>Get input values associated with a field, sectionIndex may be passed to get value of a field in specific section, otherwise it defaults to 0.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">var fieldId = '1234';

currentSubmission.getInputValueByFieldId(fieldId, function(err, res) {
    if (err) console.error(err);

    console.log('Field value: ', res);
});</programlisting>
</section>
</section>
<section xml:id="submission-events">
<title>Submission Events</title>
<simpara>The <literal>Submission</literal> Model emits events as they move through the submission process. Whenever a function is executed when an event is fired, the <literal>this</literal> object will always refer to the <literal>Submission</literal> object that emitted the event.</simpara>
<section xml:id="inprogress-the-submission-is-in-the-process-of-uploading.">
<title>inprogress The Submission Is In The Process Of Uploading.</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('inprogress', function(uploadTask) {
    var self = this;
    uploadTask.submissionModel(function(err, submissionModel) {
        //The 'this' parameter in the event refers the submission model that emitted the event.
        assert.strictEqual(self, submissionModel);
    });
});</programlisting>
</section>
<section xml:id="error-there-was-an-error-uploading-the-submission.">
<title>error: There Was An Error Uploading The Submission.</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('error', function(errorMessage) {
    console.error(errorMessage);
    assert.equal(errorMessage, this.getErrorMessage);
});</programlisting>
</section>
<section xml:id="savedraft-the-submission-was-saved-as-a-draft">
<title>savedraft: The Submission Was Saved As A Draft</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('savedraft', function() {
    //This is the local ID of the submission that emitted the 'savedraft' event.
    assert.isString(this.getLocalId());
});</programlisting>
</section>
<section xml:id="validationerror-there-was-a-validation-error-when-making-a-submission.">
<title>validationerror: There Was A Validation Error When Making A Submission.</title>
<simpara>This error is only emitted locally. This is not a validation error on the server side.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('validationerror', function(validationObject) {
    //This is the local ID of the submission that emitted the 'savedraft' event.
    assert.isString(false, validationObject.valid);
});</programlisting>
<simpara><emphasis>Validation Object</emphasis></simpara>
<programlisting language="javascript" linenumbering="unnumbered">{
    valid: &lt; true / false &gt; ,
    &lt; fieldid1 &gt; : {
        valid: &lt; true / false &gt; ,
        errorMessages: [
            "Validation Error Message 1",
            "Validation Error Message 2"
        ]
    },
    ....,
    &lt; fieldidN &gt; : {
        valid: &lt; true / false &gt; ,
        errorMessages: [
            "Validation Error Message 1",
            "Validation Error Message 2"
        ]
    }
}</programlisting>
</section>
<section xml:id="submit-the-submission-is-valid-and-can-now-be-uploaded.">
<title>submit: The Submission Is Valid And Can Now Be Uploaded.</title>
<simpara>The submission has passed local validation. It is now ready to be uploaded to the Cloud.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('submit', function() {
    //Valid Submission, it can be uploaded now or at any other time
    this.upload(function(err, uploadTask) {
            ...
    });
});</programlisting>
</section>
<section xml:id="submitted-the-submission-is-valid-and-has-completed-uploading-all-data.">
<title>submitted: The Submission Is Valid And Has Completed Uploading All Data.</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('submitted', function(remoteSubmissionId) {
    assert.equal(remoteSubmissionId, this.getRemoteSubmissionId());
});</programlisting>
</section>
<section xml:id="queued-the-submission-json-definition-has-been-uploaded.-proceeding-to-upload-any-files.">
<title>queued: The Submission JSON Definition Has Been Uploaded. Proceeding To Upload Any Files.</title>
<simpara>At this point, the <emphasis>remote</emphasis> submission ID has been assigned on the Cloud side. The submission can now be considered valid on both Client and Cloud sides.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('queued', function(remoteSubmissionId) {
    assert.equal(remoteSubmissionId, this.getRemoteSubmissionId());
});</programlisting>
</section>
<section xml:id="progress-the-progress-for-a-submission-has-been-incremented.">
<title>progress: The Progress For A Submission Has Been Incremented.</title>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('progress', function(progressJSON) {
    //The Current Progress Of The Submission
});</programlisting>
<section xml:id="progressjson">
<title>progressJSON</title>
<programlisting language="javascript" linenumbering="unnumbered">{
    'formJSON': false, //Boolean specifying if the submission JSON has been uploaded.
    'currentFileIndex': 0,
    'totalFiles': 3,
    'totalSize': 54321, //Size in Bytes of the entire submission
    'uploaded': 12345, //Size, in Bytes already uploaded
    'retryAttempts': 1, //Number of times the submission has been tried.
    'submissionTransferType': &lt; upload / download &gt; , //Is the submission being uploaded or downloaded.
    'submissionRemoteId': "remoteSubmissionID1234", //The remote submission ID if it is available.
    'submissionLocalId': "localSubmissionID1234" //The local submission ID
}</programlisting>
</section>
</section>
<section xml:id="downloaded-the-submission-has-completed-downloading-only-used-when-downloading-submissions.">
<title>downloaded: The Submission Has Completed Downloading (Only Used When Downloading Submissions.)</title>
<simpara>This also includes all files when a submission is downloaded to a mobile client device.</simpara>
<programlisting language="javascript" linenumbering="unnumbered">submission.on('downloaded', function(remoteSubmissionId) {
    assert.equal(remoteSubmissionId, this.getRemoteSubmissionId());
});</programlisting>
</section>
</section>
</section>
</chapter>
<chapter xml:id="fh-hash">
<title>$fh.hash</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.hash(options, success, failure);</programlisting>
<simpara>Generate hash value of a string.</simpara>
<itemizedlist xml:id="hash-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="hash-example">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">var options = {
  "algorithm": "SHA256", // Can be MD5 | SHA1 | SHA256 | SHA512
  "text": "Need more widgets. Add some columns." // Text to hash
};

$fh.hash(options, function (res) {
  // The generated hash value
  var hashvalue = res.hashvalue;
}, function(msg) {
  // Error message for why the hash failed
  console.error(msg);
});</programlisting>
</section>
</chapter>
<chapter xml:id="fh-init">
<title>$fh.init</title>
<simpara>In order for the Client Apps to communicate with the corresponding Cloud Apps, the client SDKs need to be initialized before making any cloud calls.</simpara>
<simpara>The initializations process involves a call to the server to verify that it is a valid app on the platform and get some properties of the app. No other API methods can be executed before this process finishes. The initialization process runs asynchronously so that the main app thread won’t be blocked.</simpara>
<itemizedlist xml:id="init-support-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="init-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>The Javascript SDK is initialized automatically once the app is loaded and as a result, it is not necessary to call the init API therefore, $fh.cloud, for example, can be used as soon as the app has loaded. To learn when the app has completed initialization, register a callback with "fhinit".</para>
</formalpara>
<programlisting language="javascript" linenumbering="unnumbered">$fh.on("fhinit", function(err, host){
  if(err){
    //Init has failed due to some error. Normally this is due to no network connection.
  } else {
    //The js sdk has initialized. The host value will be the URL of the cloud app the client app will communicate with.
  }
});</programlisting>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">FH.init(this, new FHActCallback() {
  public void success(FHResponse pRes) {
    // Init okay, free to use FHActRequest
    // Note: pRes will be null. To get the cloud host url, use FH.getCloudHost.
    String cloudAppUrl = FH.getCloudHost();
  }

  public void fail(FHResponse pRes) {
    // Init failed
    Log.e("FHInit", pRes.getErrorMessage(), pRes.getError());
  }
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">#import &lt;FH/FH.h&gt;
#import &lt;FH/FHResponse.h&gt;

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  // Override point for customization after application launch.

  // Call a cloud side function when init finishes
  void (^success)(FHResponse *)=^(FHResponse * res) {
    // Initialisation is now complete, you can now make FHCloud requests
    // Note: res will be nil. To get the cloud host url, use [FH getCloudHost].
    NSString * cloudAppUrl = [FH getCloudHost];
    NSLog(@"SDK initialised OK");
  };

  void (^failure)(id)=^(FHResponse * res){
    NSLog(@"Initialisation failed. Response = %@, res.rawResponse);
  };

  //View loaded, init the library
  [FH initWithSuccess:success AndFailure:failure];

  return YES;
}</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">import FeedHenry

func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; Bool {
  // Override point for customization after application launch.
  FH.init { (resp:Response, error: NSError?) -&gt; Void in
    if let error = error {
      print("Initialisation failed. Response = \(error)")
      return
    }
    // Initialisation is now complete, you can now make FH.cloud calls.
    print("SDK initialised OK: \(resp.parsedResponse)")
  }
  return true
}</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">try
{
  bool inited = await FHClient.Init();
  if(inited) {
    //Initialisation is successful
    //To get the cloud host url, use FH.GetCloudHost().
    string cloudAppUrl = FH.GetCloudHost();
  }
}
catch(FHException e)
{
  //Initialisation failed, handle exception
}</programlisting>
</para>
</formalpara>
</section>
</chapter>
<chapter xml:id="fh-mbaas">
<title>$fh.mbaas</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.mbaas(options, success, failure);</programlisting>
<simpara>Call MBaaS service endpoints.</simpara>
<itemizedlist xml:id="mbaas-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="mbaas-example">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.mbaas({
  "service": "db", //the MBaaS service name.
  "params": {}, //json object to send to the MBaaS service
  "timeout": 25000 // timeout value specified in milliseconds. Default: 60000 (60s)
}, function(res) {
  // Cloud call was successful. Alert the response
  alert('Got response from cloud:' + JSON.stringify(res));
}, function(msg,err) {
  // An error occured during the cloud call. Alert some debugging information
  alert('Cloud call failed with error message:' + msg + '. Error properties:' + JSON.stringify(err));
});</programlisting>
</section>
</chapter>
<chapter xml:id="fh-push">
<title>$fh.push</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.push(onNotification(e), regSuccessHandler, regErrorHandler(err), pushConfig)</programlisting>
<simpara>Register with the server to start receiving push notifications.</simpara>
<itemizedlist xml:id="push-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="push-example">
<title>Example</title>
<formalpara>
<title>Javascript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">// register with the server to start receiving push notifications
$fh.push(function(e) {
    // on android we could play a sound, if we add the Media plugin
    if (e.sound &amp;&amp; (typeof Media != 'undefined')) {
      var media = new Media("/android_asset/www/" + e.sound);
      media.play();
    }

    if (e.coldstart) {
      // notification started the app
    }

    // show text content of the message
    alert(e.alert);

    // only on iOS
    if (e.badge) {
      push.setApplicationIconBadgeNumber(successHandler, e.badge);
  }
}, function() {
  // successfully registered
}, function(err) {
  // handle errors
}, {
  // optional filtering criteria
  alias: "user@example.com",
  categories: ["Curling", "Hurling"]
});</programlisting>
</para>
</formalpara>
<itemizedlist>
<title>Parameters</title>
<listitem>
<simpara><literal>onNotification(e)</literal> Function - handler for incoming notifications, contains the following properties:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>alert</literal>, <literal>sound</literal>, <literal>badge</literal> - equivalent semantics as the corresponding options in the <literal>message</literal> object of the <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/cloud-api/#fh-push">cloud API</link></simpara>
</listitem>
<listitem>
<simpara><literal>coldstart</literal> - true, if the received notification was the cause of application start</simpara>
</listitem>
<listitem>
<simpara><literal>payload</literal> - corresponds to the <literal>message.userData</literal> option of the Cloud API</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><literal>regSuccessHandler</literal> Function - callback invoked upon successful registration</simpara>
</listitem>
<listitem>
<simpara><literal>regErrorHandler(err)</literal> Function - callback invoked if the registration fails due to an error, which is then passed
as a String argument</simpara>
</listitem>
<listitem>
<simpara><literal>pushConfig</literal> Object - optional configuration, which allows filtering of notifications received by a client using a set
of criteria. See <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/product-features/#sending-notifications">Sending Notifications</link> for
semantics of these criteria and usage information. Available properties:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>alias</literal> String - user-specific identifier</simpara>
</listitem>
<listitem>
<simpara><literal>categories</literal> Array - list of categories</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<formalpara>
<title>Android (Java)</title>
<para>Register with the server to start receiving push notifications.</para>
</formalpara>
<programlisting language="java" linenumbering="unnumbered">FH.pushRegister(new FHActCallback() {
    @Override
    public void success(FHResponse fhResponse) {
        startActivity(...);
    }


    @Override
    public void fail(FHResponse fhResponse) {
        Toast.makeText(getApplicationContext(),
                fhResponse.getErrorMessage(), Toast.LENGTH_SHORT).show();
        finish();
    }
});</programlisting>
<simpara>To handle messages, create an implementation of <literal>MessageHandler</literal>.
Register the <literal>MessageHandler</literal> with the <literal>RegistrarManager</literal> to enable it, as documented in <link xlink:href="https://aerogear.org/docs/unifiedpush/aerogear-push-android/guides/#_receiving_notifications">Receiving notifications</link> in the Aerogear
documentation.</simpara>
<programlisting language="java" linenumbering="unnumbered">import org.jboss.aerogear.android.unifiedpush.MessageHandler;
import org.jboss.aerogear.android.unifiedpush.gcm.UnifiedPushMessage;

public class MyMessageHandler implements MessageHandler {
    @Override
    public void onMessage(Context context, Bundle bundle) {
        String message = bundle.getString(UnifiedPushMessage.ALERT_KEY);
    }
}</programlisting>
<formalpara>
<title>Parameters</title>
<para>The keys in the <literal>Bundle</literal> passed to the <literal>onMessage</literal> method of the message handler:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><literal>UnifiedPushMessage.ALERT_KEY</literal> - the notification text, corresponding to the <literal>message.alert</literal> property in the <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/cloud-api/#fh-push">cloud API</link>.</simpara>
</listitem>
<listitem>
<simpara>All the keys sent with <literal>message.userData</literal> in the Cloud API, represented as strings containing JSON objects.&lt;/li&gt;</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>iOS (Objective-C)</title>
<para>Register with the server to start receiving push notifications.</para>
</formalpara>
<programlisting language="objectivec" linenumbering="unnumbered">- (void)application:(UIApplication )application didRegisterForRemoteNotificationsWithDeviceToken:(NSData )deviceToken {
  [FH pushRegister:deviceToken andSuccess:^(FHResponse success) {
    NSLog(@"Push registration successful");
  } andFailure:^(FHResponse failed) {
    NSLog(@"Push registration Error: %@", failed.error);
  }];
}</programlisting>
<simpara>Handling messages:</simpara>
<programlisting language="objectivec" linenumbering="unnumbered">- (void)application:(UIApplication )application didReceiveRemoteNotification:(NSDictionary )userInfo {
    NSLog(@"message received: %@", userInfo[@"aps"][@"alert"][@"body"]);
}</programlisting>
<itemizedlist>
<title>Parameters</title>
<listitem>
<simpara><literal>userInfo</literal> NSDictionary</simpara>
<itemizedlist>
<listitem>
<simpara><literal>aps</literal> NSDictionary</simpara>
<itemizedlist>
<listitem>
<simpara><literal>alert</literal> NSString/NSDictionary - the notification text, corresponding to the <literal>message.alert</literal> property in the <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/cloud-api/#fh-push">cloud API</link>. The type can be either <literal>NSString</literal> or <literal>NSDictionary</literal>, as documented in the <link xlink:href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/TheNotificationPayload.html">Local and Remote Notification Programming Guide</link> in iOS documentation.</simpara>
</listitem>
<listitem>
<simpara>All the keys sent with <literal>message.userData</literal> in the Cloud API.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<formalpara>
<title> .NET (C#)</title>
<para>Register with the server to start receiving push notifications.</para>
</formalpara>
<programlisting language="csharp" linenumbering="unnumbered">protected override async void OnNavigatedTo(NavigationEventArgs e)
{
    try
    {
        await FHClient.Init();
        // register with the server to start receiving push notifications
        FH.RegisterPush(HandleNotification);
    }
    catch (Exception ex)
    {
        new MessageDialog("Error", ex.Message).ShowAsync();
    }
...</programlisting>
<simpara>Handling messages:</simpara>
<programlisting language="csharp" linenumbering="unnumbered">private void HandleNotification(object sender, PushReceivedEvent e)
{
    Console.WriteLine(e.Args.Message);
}</programlisting>
<itemizedlist>
<title>Parameters</title>
<listitem>
<simpara><literal>PushReceivedEvent.Args</literal></simpara>
<itemizedlist>
<listitem>
<simpara><literal>Message</literal> string - the notification text, corresponding to the <literal>message.alert</literal> property in the <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/cloud-api/#fh-push">cloud API</link>.</simpara>
</listitem>
<listitem>
<simpara><literal>Data</literal> IDictionary&lt;string, string&gt; - a dictionary of values passed to <literal>message.userData</literal> in the Cloud API</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</section>
</chapter>
<chapter xml:id="fh-sec">
<title>$fh.sec</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sec(options, success, failure);</programlisting>
<simpara>Key pair generation and data encryption and decryption.</simpara>
<itemizedlist xml:id="sec-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="sec-example">
<title>Example</title>
<programlisting language="javascript" linenumbering="unnumbered">// Generate a new Key
var options = {
  "act": "keygen",
  "params": {
    "algorithm": "AES", // Only AES supported
    "keysize": "128" // 128 or 256
  }
};

$fh.sec(options, function(res) {
  // The algorithm used for the generation
  var algorithm = res.algorithm;

  // The generated key (hex format)
  var secretkey = res.secretkey;

  // The generated initial vector (hex format)
  var iv = res.iv;
}, function(code) {
  // Error code. One of:
  //  bad_act   : invalid action type
  //  no_params : params missing
  //  no_params_algorithm : missing algorithm in params
  console.error(code);
});


// Encrypt data
var options = {
  "act": "encrypt",
  "params": {
    // The data to be encrypted
    "plaintext": "Need a new page to start on",
    // The secret key used to do the encryption. (Hex format)
    "key": secretkey,
    // The algorithm used for encryption. Should be either "RSA" or "AES"
    "algorithm": "AES",
    // IV only required if algorithm is "AES"
    "iv": iv
  }
};
$fh.sec(options, function (res) {
  // The encrypted data (hex format)
  var ciphertext = res.ciphertext;
}, function (code) {
  // Error code. One of:
  //  bad_act   : invalid action type
  //  no_params : params missing
  //  no_params_algorithm : missing algorithm in params
  console.error(code);
});

// Decrypt data
var options = {
  "act": "encrypt",
  "params": {
    // The data to be decrypted
    "ciphertext": "dc87f02ae3fce8149d1e2b97a747581f8bc7c0c01b435a87ba56661b1ae",
    // The secret key used to do the decryption. (Hex format)
    "key": secretkey,
    // The algorithm used for decryption. Should be either "RSA" or "AES"
    "algorithm": "AES",
    // IV only required if algorithm is "AES"
    "iv": iv
  }
};
$fh.sec(options, function (res) {
  // The decrypted data (hex format)
  var plaintext = res.plaintext;
}, function (code) {
  // Error code. One of:
  //  bad_act   : invalid action type
  //  no_params : params missing
  //  no_params_algorithm : missing algorithm in params
  console.error(code);
});</programlisting>
</section>
</chapter>
<chapter xml:id="fh-sync">
<title>$fh.sync</title>
<simpara>The Sync API provides a resilient mechanism for data synchronization between a Client App and a back-end data store. When using the Sync API, the Client App should perform all data operations only through the Sync API and never through <literal>$fh.cloud</literal> calls.</simpara>
<simpara>Datasets are put under control of the Sync service by calling <literal>manage</literal> and specifying a unique ID for the dataset, along with any query parameters passed to the back-end data store to restrict the dataset.</simpara>
<simpara>The Sync client uses events to notify the app when data state has changed, such as when new records are received, updates are committed to back end, and other ones. For a deeper explanation of the concepts of the Sync Service, see <link xlink:href="https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/single/server-side-developer-guide/#data-sync-framework">Data Sync Framework</link>.</simpara>
<itemizedlist xml:id="sync-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Windows</simpara>
</listitem>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="fh-sync-init">
<title>$fh.sync.init</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.init(options);</programlisting>
<section xml:id="sync-details-1">
<title>Details</title>
<simpara>Initialise the client data sync service.</simpara>
</section>
<section xml:id="sync-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.init({
  // How often to synchronize data with the cloud, in seconds.
  // Optional. Default: 10
  "sync_frequency": 10,

  // Should local changes be synchronized to the cloud immediately, or should they wait for the next synchronization interval.
  // Optional. Default: true
  "auto_sync_local_updates": true,

  // Should a notification event be triggered when loading or saving to client storage fails.
  // Optional. Default: true
  "notify_client_storage_failed": true,

  // Should a notification event be triggered when a synchronization cycle with the server has been started.
  // Optional. Default: true
  "notify_sync_started": true,

  // Should a notification event be triggered when a synchronization cycle with the server has been completed.
  // Optional. Default: true
  "notify_sync_complete": true,

  // Should a notification event be triggered when an attempt was made to update a record while offline.
  // Optional. Default: true
  "notify_offline_update": true,

  // Should a notification event be triggered when an update failed due to data collision.
  // Optional. Default: true
  "notify_collision_detected": true,

  // Should a notification event be triggered when an update was applied to the local data store.
  // Optional. Default: true
  "notify_local_update_applied": true,

  // Should a notification event be triggered when an update failed for a reason other than data collision.
  // Optional. Default: true
  "notify_remote_update_failed": true,

  // Should a notification event be triggered when an update was applied to the remote data store.
  // Optional. Default: true
  "notify_remote_update_applied": true,

  // Should a notification event be triggered when a delta was received from the remote data store.
  // Optional. Default: true
  "notify_delta_received": true,

  // Should a notification event be triggered when a delta was received from the remote data store for a record.
  // Optional. Default: true
  "notify_record_delta_received": true,

  // Should a notification event be triggered when the synchronization loop failed to complete.
  // Optional. Default: true
  "notify_sync_failed": true,

  // Should log statements be written to console.log. Will be useful for debugging.
  // Optional. Default: false
  "do_console_log": false,

  // How many synchronization cycles to check for updates on crashed in-flight updates.
  // Optional. Default: 10
  "crashed_count_wait" : 10,

  // If crashed_count_wait limit is reached, should the client retry sending the crashed in flight pending records.
  // Optional. Default: true
  "resend_crashed_updates" : true,

  // Is the background synchronization with the cloud currently active. If this is set to false, the synchronization loop will not start automatically. You need to call startSync to start the synchronization loop.
  // Optional. Default: true
  "sync_active" : true,

  // Storage strategy to use for the underlying client storage framework Lawnchair. Valid values include 'dom', 'html5-filesystem', 'webkit-sqlite', 'indexed-db'.
  // Multiple values can be specified as an array and the first valid storage option will be used.
  // Optional. Default: 'html5-filesystem'
  "storage_strategy" : "html5-filesystem",

  // Amount of space to request from the HTML5 filesystem API when running in browser
  // Optional. Default: 50 * 1024 * 1024
  "file_system_quota" : 50 * 1024 * 1024,

  // If the app has legacy custom cloud sync function (the app implemented the data CRUDL operations in main.js file in FH V2 apps), it should be set to true. If set to false, the default MBaaS sync implementation will be used. When set to null or undefined, a check will be performed to determine which implementation to use.
  // Optional. Default: null
  "has_custom_sync" : null,

  // ios only. If set to true, the file will be backed by icloud.
  // Optional.Default: false
  "icloud_backup" : false
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">FHSyncConfig syncConfig = new FHSyncConfig();

// Should local changes be synchronized to the cloud immediately, or should
// they wait for the next synchronization interval.
// Optional. Default: false
syncConfig.setAutoSyncLocalUpdates(false);

// How many synchronization cycles to check for updates on crashed in-flight
// updates.
// Optional. Default: 10
syncConfig.setCrashCountWait(10);

// Should a notification event be triggered when loading or saving to client
//storage fails.
// Optional. Default: false
syncConfig.setNotifyClientStorageFailed(false);

// Should a notification event be triggered when a delta was received from the
//remote data store.
// Optional. Default: false
syncConfig.setNotifyDeltaReceived(false);

// Should a notification event be triggered when an update was applied to the local
//data store.
// Optional. Default: false
syncConfig.setNotifyLocalUpdateApplied(false);

// Should a notification event be triggered when an attempt was made to update a
//record while offline.
// Optional. Default: false
syncConfig.setNotifyOfflineUpdate(false);

// Should a notification event be triggered when an update was applied to the remote
//data store.
// Optional. Default: false
syncConfig.setNotifyRemoteUpdateApplied(false);

// Should a notification event be triggered when a synchronization cycle with the
//server has been started.
// Optional. Default: false
syncConfig.setNotifySyncStarted(false);

// Should a notification event be triggered when the synchronization loop failed to complete.
// Optional. Default: false
syncConfig.setNotifySyncFailed(false);

// Should a notification event be triggered when a synchronization cycle with the
// server has been completed.
// Optional. Default: false
syncConfig.setNotifySyncComplete(false);

// Should a notification event be triggered when an update failed due to data collision.
// Optional. Default: false
syncConfig.setNotifySyncCollisions(false);

// Should a notification event be triggered when an update failed for a reason other
//than data collision.
// Optional. Default: false
syncConfig.setNotifyUpdateFailed(false);

// If the limit set in setCrashCountWait is reached, should the client
// retry sending the crashed in-flight pending records.
// Optional. Default: true
syncConfig.setResendCrashedUpdates(true);

// How often to synchronize data with the cloud, in seconds.
// Optional. Default: 10
syncConfig.setSyncFrequency(10);

// If the app has legacy custom cloud sync function (the app implemented the data
//CRUDL operations in main.js file in FH V2 apps), it should be set to true. If set
//to false, the default MBaaS sync implementation will be used.
// Optional. Default: false
syncConfig.setUseCustomSync(false);

syncClient = FHSyncClient.getInstance();
syncClient.init(appContext, syncConfig, new FHSyncListener() {
                                                    /**The implementation for this class
                                                    * is discussed later in this document
                                                    **/
                                                });</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">let conf = FHSyncConfig()

// How often to synchronize data with the cloud, in seconds.
// Optional. Default: 10
conf?.syncFrequency = 10

// Should local changes be synchronized to the cloud immediately, or should they wait for the next synchronization interval.
// Optional. Default: true
conf?.autoSyncLocalUpdates = true

// Should a notification event be triggered when loading or saving to client storage fails.
// Optional. Default: false
conf?.notifyClientStorageFailed = true

// Should a notification event be triggered when a synchronization cycle with the server has been started.
// Optional. Default: false
conf?.notifySyncStarted = true

// Should a notification event be triggered when a synchronization cycle with the server has been completed.
// Optional. Default: false
conf?.notifySyncCompleted = true

// Should a notification event be triggered when an attempt was made to update a record while offline.
// Optional. Default: false
conf?.notifyOfflineUpdate = true

// Should a notification event be triggered when an update failed due to data collision.
// Optional. Default: false
conf?.notifySyncCollision = true

// Should a notification event be triggered when an update was applied to the local data store.
// Optional. Default: false
conf?.notifyLocalUpdateApplied = true

// Should a notification event be triggered when an update failed for a reason other than data collision.
// Optional. Default: false
conf?.notifyRemoteUpdateFailed = true

// Should a notification event be triggered when an update was applied to the remote data store.
// Optional. Default: false
conf?.notifyRemoteUpdateApplied = true

// Should a notification event be triggered when a delta was received from the remote data store.
// Optional. Default: false
conf?.notifyDeltaReceived = true

// Should a notification event be triggered when the synchronization loop failed to complete.
// Optional. Default: false
conf?.notifySyncFailed = true

// Should log statements be written to console.log. Will be useful for debugging.
// Optional. Default: false
conf?.debug = true

// How many synchronization cycles to check for updates on crashed in-flight updates.
// Optional. Default: 10
conf?.crashCountWait = 10

// If crashCountWait limit is reached, should the client retry sending the crashed in flight pending records.
// Optional. Default: true
conf?.resendCrashedUpdates = true

// If the app has legacy custom cloud sync function (the app implemented the data CRUDL operations in main.js file in FH V2 apps), it should be set to true. If set to false, the default MBaaS sync implementation will be used. When set to null or undefined, a check will be performed to determine which implementation to use.
// Optional. Default: false
conf?.hasCustomSync = false

// iOS only. If set to YES, the file will be backed by icloud.
// Optional.Default: false
conf?.icloud_backup = false

syncClient = FHSyncClient(config: conf)</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">FHSyncConfig* conf = [[FHSyncConfig alloc] init];

// How often to synchronize data with the cloud, in seconds.
// Optional. Default: 10
conf.syncFrequency = 10;

// Should local changes be synchronized to the cloud immediately, or should they wait for the next synchronization interval.
// Optional. Default: YES
conf.autoSyncLocalUpdates = YES;

// Should a notification event be triggered when loading or saving to client storage fails.
// Optional. Default: NO
conf.notifyClientStorageFailed = YES;

// Should a notification event be triggered when a synchronization cycle with the server has been started.
// Optional. Default: NO
conf.notifySyncStarted = YES;

// Should a notification event be triggered when a synchronization cycle with the server has been completed.
// Optional. Default: NO
conf.notifySyncCompleted = YES;

// Should a notification event be triggered when an attempt was made to update a record while offline.
// Optional. Default: NO
conf.notifyOfflineUpdate = YES;

// Should a notification event be triggered when an update failed due to data collision.
// Optional. Default: NO
conf.notifySyncCollision = YES;

// Should a notification event be triggered when an update was applied to the local data store.
// Optional. Default: NO
conf.notifyLocalUpdateApplied = YES;

// Should a notification event be triggered when an update failed for a reason other than data collision.
// Optional. Default: NO
conf.notifyRemoteUpdateFailed = YES;

// Should a notification event be triggered when an update was applied to the remote data store.
// Optional. Default: NO
conf.notifyRemoteUpdateApplied = YES;

// Should a notification event be triggered when a delta was received from the remote data store.
// Optional. Default: NO
conf.notifyDeltaReceived = YES;

// Should a notification event be triggered when the synchronization loop failed to complete.
// Optional. Default: NO
conf.notifySyncFailed = YES;

// Should log statements be written to console.log. Will be useful for debugging.
// Optional. Default: NO
conf.debug = YES;

// How many synchronization cycles to check for updates on crashed in-flight updates.
// Optional. Default: 10
conf.crashCountWait = 10;

// If crashCountWait limit is reached, should the client retry sending the crashed in flight pending records.
// Optional. Default: YES
conf.resendCrashedUpdates = YES;

// If the app has legacy custom cloud sync function (the app implemented the data CRUDL operations in main.js file in FH V2 apps), it should be set to true. If set to false, the default MBaaS sync implementation will be used. When set to null or undefined, a check will be performed to determine which implementation to use.
// Optional. Default: NO
conf.hasCustomSync = NO;

// iOS only. If set to YES, the file will be backed by icloud.
// Optional.Default: NO
conf.icloud_backup = NO;

FHSyncClient* syncClient = [[FHSyncClient alloc] initWithConfig:conf];</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">var client = FHSyncClient.GetInstance();
var config = new FHSyncConfig();

/// How often to synchronize data with the cloud, in seconds.
/// Default Value : 10
config.SyncFrequency = 10;

/// Should local changes be synchronized to the cloud immediately, or should they wait for the next synchronization interval.
/// Default value : true
config.AutoSyncLocalUpdates = true;

/// How many synchronization cycles to check for updates on crashed in-flight updates.
/// Default value : 10
config.CrashedCountWait = 10;

/// If CrashedCountWait limit is reached, should the client retry sending the crashed in flight pending records.
/// Default value : true
config.ResendCrashedUpdated = true;

/// Is the background sync with the cloud currently active. If this is set to false, the sync loop will not start automatically. You need to call Start to start the synchronization loop.
/// Default value : true
config.SyncActive = true;

/// Set whether to use a legacy FH V2 sync Cloud App, the MBaaS sync service,
/// or automatically select.
/// Values are SyncCloudType.Auto, SyncCloudType.Legacy, SyncCloudType.Mbbas
/// Default value : Auto
config.SyncCloud = SyncCloudType.Auto;

client.Initialise(config);</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-notify">
<title>$fh.sync.notify</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.notify(callback(data));</programlisting>
<section xml:id="sync-details-2">
<title>Details</title>
<simpara>Register a callback function to be invoked when the sync service has notifications to communicate to the client.</simpara>
</section>
<section xml:id="sync-example-1">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.notify(function(event) {
  // The dataset that the notification is associated with
  var dataset_id = event.dataset_id;

    // The unique identifier that the notification is associated with.
  // This will be the unique identifier for a record if the notification is related to an individual record,
  // or the current hash of the dataset if the notification is associated with a full dataset
  //  (for example, sync_complete)
  var uid = event.uid;

  // Optional free text message with additional information
  var message = event.message;

  // The notification message code
  var code = event.code;
   /* Codes:
    * client_storage_failed: Loading or saving to client storage failed. This is a critical error and the Sync Client will not work properly without client storage.
    * sync_started: A synchronization cycle with the server has been started.
    * sync_complete: A synchronization cycle with the server has been completed.
    * offline_update: An attempt was made to update or delete a record while offline.
    * collision_detected: Update failed due to data collision.
    * remote_update_failed: Update failed for a reason other than data collision.
    * remote_update_applied: An update was applied to the remote data store.
    * local_update_applied: An update was applied to the local data store.
    * delta_received: A change was received from the remote data store for the dataset. It is best to listen to this notification and update the UI accordingly.
    * record_delta_received: A delta was received from the remote data store for the record. It is best to listen to this notification and update UI accordingly.
    * sync_failed: Synchronization loop failed to complete.
    */
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>Synchronization events are sent to the <literal>FHSyncListener</literal> instance you registered using <literal>syncClient.init</literal>. Each method of the listener is provided a non-null <literal>NotificationMessage</literal> parameter.</para>
</formalpara>
<programlisting language="java" linenumbering="unnumbered">public class SampleSyncListener implements FHSyncListener {


  public void onSyncStarted(NotificationMessage notificationMessage) {
      /*Data sync is available. Update your UI, enable editing fields,
          display messages to the user, etc.*/
  }

  public void onSyncCompleted(NotificationMessage notificationMessage) {

      /*Sync has completed. Data has been successfully sent to the server or
         successfully received from the server. In either case you should refresh
         the data presented to the user.

      You may retrieve your latest data for this message with
      FHSyncClient.getInstance().list(notificationMessage.getDataId())*/
  }

  public void onUpdateOffline(NotificationMessage notificationMessage) {
      /*A create, delete, or update operation was called, but the device is
      not connected to the network. The UI should be updated, fields disabled,
      user notified, etc.*/
  }

  public void onCollisionDetected(NotificationMessage notificationMessage) {
      /* The update could not be applied to the server. There are many reasons
      why this could happen and it is up to the application developer to
      resolve the collision.

      After the data has been updated to synchronize cleanly, the methods
      FHSyncClient.listCollisions and FHSyncClient.removeCollision can be used
      to view and resolve the collision entries.

      Use FHSyncClient.getInstance().read(notificationMessage.getDataId(),
                                          notificationMessage.getUID())
      to view the data record.

      */
  }

  public void onRemoteUpdateFailed(NotificationMessage notificationMessage) {
      /* The remote updated failed. You may use notificationMessage.getExtraMessage()
      to get additional details.

      Use FHSyncClient.getInstance().read(notificationMessage.getDataId(),
                                          notificationMessage.getUID())
      to view the data record.*/
  }

  public void onRemoteUpdateApplied(NotificationMessage notificationMessage) {
      /* An update was successfully processed by the remote server.

      Use FHSyncClient.getInstance().read(notificationMessage.getDataId(),
                                          notificationMessage.getUID())
      to view the data record.
      */
  }

  public void onLocalUpdateApplied(NotificationMessage notificationMessage) {
      /* An update is applied locally and waiting to be sent to the remote
      server.

      Use FHSyncClient.getInstance().read(notificationMessage.getDataId(),
                                          notificationMessage.getUID())
      to view the data record.
      */
  }

  public void onDeltaReceived(NotificationMessage notificationMessage) {
      /*An incoming update has been applied. The UI should be updated if appropriate.

      Use FHSyncClient.getInstance().read(notificationMessage.getDataId(),
                                          notificationMessage.getUID())
      to view the data record.

      Use FHSyncClient.getInstance().list(notificationMessage.getDataId())
      to load all data records.

      notificationMessage.getExtraMessage() will return the type of operation
      (update, delete, create) which was performed.

      */
  }

  public void onSyncFailed(NotificationMessage notificationMessage) {
      /*
      For some reason the sync loop was unable to complete.  This could be for
      many different reasons such as network connectivity, authentication
      issues, programming errors, etc.

      Use notificationMessage.getExtraMessage() to get extra information.

      */
  }

  public void onClientStorageFailed(NotificationMessage notificationMessage) {
      /*
      Sync was not able to store data locally.  This indicates a device error
      such as out of space, invalid permissions, etc

      Use notificationMessage.getExtraMessage() to get extra information.
      */
  }
}</programlisting>
<formalpara>
<title>iOS (Objective-C)</title>
<para>Synchronization notifications are dispatched via the standard <literal>NSNotificationCenter</literal> facility. To start receiving <literal>kFHSyncStateChangedNotification</literal> notifications, register using the <literal>addObserver:selector:name:object:</literal> or <literal>addObserverForName:object:queue:usingBlock:</literal> methods of <literal>NSNotificationCenter</literal>.</para>
</formalpara>
<programlisting language="objectivec" linenumbering="unnumbered">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(onSyncMessage:) name:kFHSyncStateChangedNotification object:nil];

* (void) onSyncMessage:(NSNotification*) note
{
FHSyncNotificationMessage* msg = (FHSyncNotificationMessage*) [note object];
NSString* code = msg.code;
if([code isEqualToString:REMOTE_UPDATE_APPLIED_MESSAGE]) {
}
  /* Codes:
  *
  * NSString *const SYNC_STARTED_MESSAGE = @"SYNC_STARTED";
  * A synchronization cycle with the server has been started.
  *
  * NSString *const SYNC_COMPLETE_MESSAGE = @"SYNC_COMPLETE";
  * A synchronization cycle with the server has been completed.
  *
  * NSString *const SYNC_FAILED_MESSAGE = @"SYNC_FAILED";
  * Synchronization loop failed to complete.
  *
  * NSString *const OFFLINE_UPDATE_MESSAGE = @"OFFLINE_UPDATE";
  * An attempt was made to update or delete a record while offline.
  *
  * NSString *const COLLISION_DETECTED_MESSAGE = @"COLLISION_DETECTED";
  * Update failed due to data collision.
  *
  * NSString *const REMOTE_UPDATE_FAILED_MESSAGE = @"REMOTE_UPDATE_FAILED";
  * Update failed for a reason other than data collision.
  *
  * NSString *const REMOTE_UPDATE_APPLIED_MESSAGE = @"REMOTE_UPDATE_APPLIED";
  * An update was applied to the remote data store.
  *
  * NSString *const LOCAL_UPDATE_APPLIED_MESSAGE = @"LOCAL_UPDATE_APPLIED";
  * An update was applied to the local data store.
  *
  * NSString *const DELTA_RECEIVED_MESSAGE = @"DELTA_RECEIVED";
  * An change was received from the remote data store for the dataset.
  * It's best to listen to this notification and update UI accordingly.
  *
  * NSString *const CLIENT_STORAGE_FAILED_MESSAGE = @"CLIENT_STORAGE_FAILED";
  * Loading or saving to client storage failed. This is a critical error and the Sync Client will not work properly without client storage.
  */
}</programlisting>
<formalpara>
<title>iOS (Swift)</title>
<para>Synchronization notifications are dispatched via the standard <literal>NSNotificationCenter</literal> facility. To start receiving <literal>kFHSyncStateChangedNotification</literal> notifications, register using the <literal>addObserver(\_:selector:name:object:)</literal> or <literal>addObserverForName(\_:object:queue:usingBlock:)</literal> methods of <literal>NSNotificationCenter</literal>.</para>
</formalpara>
<programlisting language="swift" linenumbering="unnumbered">NotificationCenter.default.addObserver(self,
                                       selector:#selector(onSyncMessage(note:)),
                                       name:Notification.Name(rawValue: "kFHSyncStateChangedNotification"),
                                       object:nil
)

let DATA_ID = "myDataId"
let syncClient = FHSyncClient(config: conf)
syncClient?.manage(withDataId: DATA_ID, andConfig:nil, andQuery:[:])

@objc func onSyncMessage(note: NSNotification) {
    if let msg = note.object as? FHSyncNotificationMessage, let code = msg.code {
        if code == REMOTE_UPDATE_APPLIED_MESSAGE {
        }
        /* Codes:
         *
         * let SYNC_STARTED_MESSAGE = "SYNC_STARTED"
         * A synchronization cycle with the server has been started.
         *
         * let SYNC_COMPLETE_MESSAGE = "SYNC_COMPLETE"
         * A synchronization cycle with the server has been completed.
         *
         * let SYNC_FAILED_MESSAGE = "SYNC_FAILED"
         * Synchronization loop failed to complete.
         *
         * let OFFLINE_UPDATE_MESSAGE = "OFFLINE_UPDATE"
         * An attempt was made to update or delete a record while offline.
         *
         * let COLLISION_DETECTED_MESSAGE = "COLLISION_DETECTED"
         * Update failed due to data collision.
         *
         * let REMOTE_UPDATE_FAILED_MESSAGE = "REMOTE_UPDATE_FAILED"
         * Update failed for a reason other than data collision.
         *
         * let REMOTE_UPDATE_APPLIED_MESSAGE = "REMOTE_UPDATE_APPLIED"
         * An update was applied to the remote data store.
         *
         * let LOCAL_UPDATE_APPLIED_MESSAGE = "LOCAL_UPDATE_APPLIED"
         * An update was applied to the local data store.
         *
         * let DELTA_RECEIVED_MESSAGE = "DELTA_RECEIVED"
         * An change was received from the remote data store for the dataset.
         * It's best to listen to this notification and update UI accordingly.
         *
         * let CLIENT_STORAGE_FAILED_MESSAGE = "CLIENT_STORAGE_FAILED"
         * Loading or saving to client storage failed. This is a critical error and the Sync Client will not work properly without client storage.
         */
    }
}</programlisting>
<formalpara>
<title> .NET (C#)</title>
<para>In the following section, <literal>client</literal> is a configured and initialised <literal>FHSyncClient</literal> instance. You can set event handlers of the type <literal>EventHandler&lt;FHSyncNotificationEventArgs&gt;</literal> to the different event types supported by the client.</para>
</formalpara>
<programlisting language="csharp" linenumbering="unnumbered">/// The event arguments that will be sent to the sync event listeners
public class FHSyncNotificationEventArgs : EventArgs
{
    /// The id of the dataset
    public string DatasetId { set; get; }

    ///     The unique universal id of the record
    public string Uid { private get; set; }

    ///     Type fo the notification.
    public SyncNotification Code { get; set; }

    ///     An message associated with the event argument. Could be empty.
    public string Message { get; set; }

}

/// Loading or saving to client storage failed. This is a critical error and the Sync Client will not work properly without client storage.
client.ClientStorageFailed += async (sender, args) =&gt; { };

/// A synchronization cycle with the server has been started.
client.SyncStarted += async (sender, args) =&gt; { };

/// A synchronization cycle with the server has been completed.
client.SyncCompleted += async (sender, args) =&gt; { };

/// An attempt was made to update or delete a record while offline.
client.OfflineUpdate += async (sender, args) =&gt; { };

/// Update failed due to data collision.
client.CollisionDetected += async (sender, args) =&gt; { };

/// Update failed for a reason other than data collision.
client.RemoteUpdateFailed += async (sender, args) =&gt; { };

/// An update was applied to the local data store.
client.LocalUpdateApplied += async (sender, args) =&gt; { };

/// An update was applied to the remote data store.
client.RemoteUpdateApplied += async (sender, args) =&gt; { };

/// A change was received from the remote data store for the dataset. It's best to listen to this notification and update UI accordingly.
client.DeltaReceived += async (sender, args) =&gt; { };

/// A delta was received from the remote data store for the record. It's best to listen to this notification and update UI accordingly.
client.RecordDeltaReceived += async (sender, args) =&gt; { };

/// Synchronization loop failed to complete.
client.SyncFailed += async (sender, args) =&gt; { };</programlisting>
</section>
<section xml:id="fh-sync-notifications">
<title>Sync Notifications</title>
<simpara>This section describes the notification structures for the JavaScript SDK.
The Objective-C, Swift, Android and .NET SDKs all define notification structure with dedicated objects, however the JavaScript information should be useful for all SDKs.</simpara>
<simpara>Notifications in the JavaScript SDK have the following structure:</simpara>
<programlisting language="" linenumbering="unnumbered">{
  "dataset_id": String,
  "uid": [String],
  "code": String,
  "message": Object|String
}</programlisting>
<simpara>where:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>dataset_id</literal> is the name of the dataset relating to the notification.</simpara>
</listitem>
<listitem>
<simpara><literal>uid</literal> is the the UID of the related record. This is either a temporary UID for a non-persisted record (record hash), or a permanent UID for a persisted record.
The value for <literal>uid</literal> can be <literal>null</literal> when the notification does not refer to a specific record, for example,  <literal>sync_started</literal>, <literal>sync_failed</literal> and
<literal>local_update_applied</literal>.  Also, there is no  <literal>uid</literal> entry for some notifications, for example, <literal>sync_complete</literal>. See individual notification structures for
more details.</simpara>
</listitem>
<listitem>
<simpara><literal>code</literal> is the identifier for the type of notification, for example, <literal>sync_started</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>message</literal> is the extra data sent along with the notification and is different for each notification. See details
of each notification for more information.</simpara>
</listitem>
</itemizedlist>
<section xml:id="fh-sync-notifications-sync-started">
<title>Sync Started</title>
<simpara>A sync loop is started. This notification is sent once per sync loop regardless of whether the client is online or offline.</simpara>
<section xml:id="notification_code" remap="_notification_code">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>Javascript - <literal>sync_started</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>SYNC_STARTED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure" remap="_notification_structure">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id": "myDataset",
  "uid": null, <co xml:id="CO1-1"/>
  "code": "sync_started",
  "message": null <co xml:id="CO1-2"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO1-1">
<para><literal>uid</literal> is always <literal>null</literal>.</para>
</callout>
<callout arearefs="CO1-2">
<para><literal>message</literal> is always <literal>null</literal>.</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-sync-complete">
<title>Sync Complete</title>
<simpara>A sync loop is  complete. A sync loop includes the initial sync request to the backend and any further
requests or actions that are taken as a result of the response. This notification does not occur in the same sync loop as a <literal>sync_failed</literal> event, that is, a sync loop can either complete or fail.</simpara>
<section xml:id="notification_code_2" remap="_notification_code_2">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>sync_complete</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>SYNC_COMPLETE</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_2" remap="_notification_structure_2">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id": "myDataset",
  "code": "sync_complete",
  "message": "online" // message is always "online"
}</programlisting>
<note>
<simpara><literal>uid</literal> never appears as part of this structure.</simpara>
</note>
</section>
</section>
<section xml:id="fh-sync-notifications-sync-failed">
<title>Sync Failed</title>
<simpara>The sync loop failed to complete. This can occur in the following circumstances:
* The sync client is  offline during the sync loop.
* A sync or sync records request receives an error code in the response, for example, 500.
Sync failed notifications are only sent if the <literal>notify_sync_failed</literal> option is set to <literal>true</literal>.</simpara>
<section xml:id="notification_code_3" remap="_notification_code_3">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>sync_failed</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>SYNC_FAILED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_3" remap="_notification_structure_3">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id": "myDataset",
  "uid": "a3387ce5d175cf73ec5f5d7614c7c6b4f44393f2_1",
  "code": "sync_failed",
  "message": "offline" <co xml:id="CO2-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO2-1">
<para><literal>message</literal> is "offline" when the client is offline. In other cases, the message contains the failed response message from the sync server.</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-record-delta-received">
<title>Record Delta Received</title>
<note>
<simpara>This notification only exists in the JavaScript SDK. Delta Received performs the same task in all other SDKs.</simpara>
</note>
<simpara>A change is received by the remote datastore for a record.
This notification occurs for each change (<literal>update</literal>, <literal>delete</literal>, <literal>create</literal>) returned in a sync response.</simpara>
<section xml:id="notification_code_4" remap="_notification_code_4">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>record_delta_received</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_4" remap="_notification_structure_4">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id": "myDataset",
  "uid": "58e3b2cff7fc7297eb635053",
  "code": "record_delta_received",
  "message": "update" <co xml:id="CO3-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO3-1">
<para><literal>message</literal> can be "create", "update" or "delete".</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-delta-received">
<title>Delta Received</title>
<simpara>A change is received by a remote datastore for a dataset.
In the JavaScript SDK this occurs once for each sync records call. This differs from the <literal>record_delta_received</literal> event because it occurs only once even if there are multiple changes and the event object provides the global hash. Use this notification to know if updates have been received from the backend, but do not require knowledge about the changes.</simpara>
<simpara>In the Objective-C, Swift and Android SDKs this notification acts as the <literal>record_delta_received</literal> notification, that is, it occurs once for each update returned by the sync server.</simpara>
<section xml:id="notification_code_5" remap="_notification_code_5">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>delta_received</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>DELTA_RECEIVED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_5" remap="_notification_structure_5">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id": "myDataset",
  "uid": "a3387ce5d175cf73ec5f5d7614c7c6b4f44393f2_1",
  "code": "delta_received",
  "message": "partial dataset" <co xml:id="CO4-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO4-1">
<para><literal>message</literal> is always "partial dataset".</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-local-update-applied">
<title>Local Update Applied</title>
<simpara>A change is applied to a local dataset. This happens in the following circumstances:
* A dataset is loaded from local data storage.
* A dataset is updated locally with a new pending record, for example, a user creating a new record.
This notification does not occur when a change is received from the server that originated on another client. If you want to check for that type of change, use the <literal>record_delta_received</literal> event.</simpara>
<section xml:id="notification_code_6" remap="_notification_code_6">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>local_update_applied</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>LOCAL_UPDATE_APPLIED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_6" remap="_notification_structure_6">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id":"myDataset",
  "uid":"8783f802c8d43053ee2bf02009dd79d89b186afb",
  "code":"local_update_applied",
  "message":"update" <co xml:id="CO5-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO5-1">
<para><literal>message</literal> can be "load", "create", "update" or "delete".</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-remote-update-applied">
<title>Remote Update Applied</title>
<simpara>An update is applied to the remote datastore. This notification occurs once for each
record that has been successfully applied on the backend.</simpara>
<section xml:id="notification_code_7" remap="_notification_code_7">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>remote_update_applied</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>REMOTE_UPDATE_APPLIED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_7" remap="_notification_structure_7">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id":"myDataset",
  "uid":"58e3b2e6f7fc7297eb635100",
  "code":"remote_update_applied",
  "message":{ <co xml:id="CO6-1"/>
    "_id":"58e3b2e60d6412349926e95b",
    "action":"create",
    "cuid":"5733885DDC134A6FA9754BA67E4E4BAC",
    "hash":"66c3961bc1dc7139427a95d3471a27ae30d4cb96",
    "msg":null,
    "oldUid":"66c3961bc1dc7139427a95d3471a27ae30d4cb96",
    "timestamp":1491317478112,
    "type":"applied",
    "uid":"58e3b2e6f7fc7297eb635100"
  }
}</programlisting>
<calloutlist>
<callout arearefs="CO6-1">
<para><literal>message</literal> is an <literal>update</literal> object received from the sync server.</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-remote-update-failed">
<title>Remote Update Failed</title>
<simpara>An update failed to be applied to the remote datastore. This notification occurs once for
each record that failed to be applied. The typical reason for an update failing is that the data could not be
persisted to the remote datastore.</simpara>
<section xml:id="notification_code_8" remap="_notification_code_8">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>remote_update_failed</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>REMOTE_UPDATE_FAILED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_8" remap="_notification_structure_8">
<title>Notification Structure</title>
<simpara>Similar to <literal>remote_update_applied</literal>, but with the <literal>code</literal> changed.</simpara>
</section>
</section>
<section xml:id="fh-sync-notifications-collision-detected">
<title>Collision Detected</title>
<simpara>A collision is found on the sync server. This notification occurs once for each collision
that is detected by the sync server. A collision occurs when an out-of-date client attempts to update a record
that has changed state. How the collision is handled is determined by the server-side collision handler.</simpara>
<section xml:id="notification_code_9" remap="_notification_code_9">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>collision_detected</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>COLLISION_DETECTED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_9" remap="_notification_structure_9">
<title>Notification Structure</title>
<simpara>Similar to <literal>remote_update_applied</literal>, but with the <literal>code</literal> changed.</simpara>
</section>
</section>
<section xml:id="fh-sync-notifications-offline-update">
<title>Offline Update</title>
<simpara>A record is added, updated or removed from the dataset while the client is offline.</simpara>
<section xml:id="notification_code_10" remap="_notification_code_10">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>offline_update</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>OFFLINE_UPDATE</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_10" remap="_notification_structure_10">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id":"myDataset",
  "uid":"58e3b2cff7fc7297eb635053",
  "code":"offline_update",
  "message":"update" <co xml:id="CO7-1"/>
}</programlisting>
<calloutlist>
<callout arearefs="CO7-1">
<para><literal>message</literal> can be "create", "update" or "delete".</para>
</callout>
</calloutlist>
</section>
</section>
<section xml:id="fh-sync-notifications-client-storage-failed">
<title>Client Storage Failed</title>
<simpara>The underlying data storage of sync (Lawnchair) encountered an issue. This could happen in
the case where a query fails to complete.</simpara>
<section xml:id="notification_code_11" remap="_notification_code_11">
<title>Notification Code</title>
<itemizedlist>
<listitem>
<simpara>JavaScript - <literal>client_storage_failed</literal></simpara>
</listitem>
<listitem>
<simpara>Objective-C/Swift - <literal>CLIENT_STORAGE_FAILED</literal></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="notification_structure_11" remap="_notification_structure_11">
<title>Notification Structure</title>
<programlisting language="javascript" linenumbering="unnumbered">{
  "dataset_id": "myDataset",
  "uid": null, <co xml:id="CO8-1"/>
  "code": "client_storage_failed",
  "message": "load from local storage failed"
}</programlisting>
<calloutlist>
<callout arearefs="CO8-1">
<para><literal>uid</literal> is always <literal>null</literal>.</para>
</callout>
</calloutlist>
</section>
</section>
</section>
</section>
<section xml:id="fh-sync-manage">
<title>$fh.sync.manage</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.manage(dataset_id, options, query_params, meta_data, callback);</programlisting>
<section xml:id="sync-details-3">
<title>Details</title>
<simpara>Put a dataset under the management of the sync service. Calling manage multiple times for the same dataset will update the options and query_params but will not result in the dataset syncing multiple times.</simpara>
<note>
<simpara>Use MongoDB query syntax when setting a value for query_params.</simpara>
</note>
</section>
<section xml:id="sync-example-2">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

// Configuration options object.
// These override the options passed to init.
var options = {
"sync_frequency": 30 // Sync every 30 seconds for the 'tasks' dataset
};

// Parameters object to be passed to the cloud sync service.
// It will be passed to the dataHandler when listing dataset on the back end.
// If the default MBaaS cloud implementation is used (which uses $fh.db for data handlers), all the valid list options can be used here.
// For example, to list the tasks that are assigned to a user called "Tom", the query params should be
var query_params = {
"$eq": {
"assigned": "Tom"
}
};

// Extra params that will be sent to the back-end data handlers.
var meta_data = {};
$fh.sync.manage(dataset_id, options, query_params, meta_data, function(){
console.log('dataset ' + dataset_id + ' is now managed by sync');
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">//queryParams are any query supported by $fh.db
JSONObject queryParams = new JSONObject();

//MetaData such as sessionTokens, userIds, etc
JSONObject metaData = new JSONObject();

//Any String identifier
String dataSet = "myDataSetId";

// If configOverride is null then the config provided in FHSyncClient.init
// will be used instead.
FHSyncConfig configOverride = null;

FHSyncClient.getInstance().manage(dataSet, configOverride, queryParams, metaData);</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.
#define DATA_ID @"tasks"

// Configuration options object.
// These override the options passed to init.
FHSyncConfig* conf = [[FHSyncConfig alloc] init];
conf.syncFrequency = 10;

// Parameters object to be passed to the cloud sync service.
// For example, to list the tasks that are assigned to a user called "Tom":
NSDictionary* query = @{@"assigned": @"Tom"};

// Extra params that will be sent to the back-end data handlers.
NSMutableDictionary* metaData = nil;

// Initialise Sync Client
FHSyncClient* syncClient = [[FHSyncClient alloc] initWithConfig:conf];

// Put a dataset under the management of the sync service.
[syncClient manageWithDataId:DATA_ID AndConfig:conf AndQuery:query AndMetaData:metaData];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">public let DATA_ID = "tasks"

// Configuration options object.
// These override the options passed to init.
let conf = FHSyncConfig()
conf?.syncFrequency = 10

// Parameters object to be passed to the cloud sync service.
// For example, to list the tasks that are assigned to a user called "Tom":
let query = ["assigned": "Tom"]

// Initialise Sync Client
let syncClient = FHSyncClient(config: conf)

// Put a dataset under the management of the sync service.
syncClient.manageWithDataId(DATA_ID, andConfig:conf, andQuery:query)</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>In the following section, <literal>client</literal> is a configured and initialised FHSyncClient instance. DataSets managed by FHSyncClient on the Windows platforms must implement the interface <literal>IFHSyncModel</literal>.</para>
</formalpara>
<programlisting language="csharp" linenumbering="unnumbered">/// The datasetId needs to be unique for your app and will be used to name the
/// collection in the cloud.
const string DatasetId = "tasks";

/// Query is a Dictionary of parameters to be sent to the server with each sync
/// operation. If the default MBaaS cloud implementation is used (which uses
/// $fh.db for data handlers), all the valid list options can be used here.
/// For example, to list the tasks that are assigned to a user called "Tom",
/// the query params should be
Dictionary&lt;string, string&gt; query = new Dictionary&lt;string, string&gt;
{
{"eq", "{"assigned", "Tom"}"}
};

/// When you manage a DataSet you may set new configuration parameters to
/// override the parameters for the sync client. If you do not wish to do this,
/// you may pass null into the FHSyncClient.manage method.
var config = new FHSyncConfig();
config.SyncFrequency = 100;

/// Put a dataset under the management of the sync service. Note that Task
/// is an implementation of the IFHSyncModel.
client.Manage&lt;Task&gt;(DatasetId, config, query);</programlisting>
</section>
</section>
<section xml:id="fh-sync-dolist">
<title>$fh.sync.doList</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.doList(dataset_id, success, failure);</programlisting>
<section xml:id="sync-details-4">
<title>Details</title>
<simpara>Get a list of the records for the dataset.</simpara>
</section>
<section xml:id="sync-example-3">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">// Unique Id for the dataset to manage.
// This must correspond to an “act” function which represents the cloud portion of the sync contract.
var dataset_id = 'tasks';

$fh.sync.doList(dataset_id, function(res) {
// The data returned by the sync service.
// Always a full data set (even in the case of deltas).
console.log(res);

//res is a JSON object
for(var key in res){
  if(res.hasOwnProperty(key)){
    // Unique Id of the record, used for read, update &amp; delete operations (string).
    var uid = key;
    // Record data, opaque to sync service.
    var data = res[key].data;
    // Unique hash value for this record
    var hash = res[key].hash;
  }
}

}, function(code, msg) {
// Error code. Currently only 'unknown_dataset' is possible
console.error(code);

// Optional free text message with additional information
console.error(msg);

});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">FHClient fhClient = FHSyncClient.getInstance();

// Unique Id for the dataset being manage.
String dataSetId = "photos";

// The data returned by the sync service.
// Always a full data set (even in the case of deltas).
JSONObject allData = fhClient.getSyncClient().list("photos");

Iterator&lt;String&gt; keysIterator = allData.keys();
List&lt;Project&gt; itemsToSync = new ArrayList&lt;&gt;();

while (keysIterator.hasNext()) {
// Unique Id of the record, used for read,
//update &amp; delete operations (string).
String uid = keysIterator.next();

  // Record data
  JSONObject record = allData.getJSONObject(uid);

  // The synced data object.  In Android this can be a JSON serialized POJO
  JSONObject dataObj = data.getJSONObject("data");

  // Unique hash value for this record
  String hash = records.getString("hash");

}

projects.addAll(itemsToSync);
bus.post(new ProjectsAvailable(new ArrayList&lt;Project&gt;(projects)));</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.
#define DATA_ID @"tasks"

// The data returned by the sync service.
// Always a full data set (even in the case of deltas).
NSDictionary* items = [syncClient listWithDataId:DATA_ID];
[items enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) {
// Unique Id of the record, used for read,
// update &amp; delete operations (string).
NSString* uid = key; +
// Record data
NSDictionary* object = obj;
NSDictionary* dataObj = object[@"data"];
uid = object[@"uid"];
}];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"
// The data returned by the sync service.
// Always a full data set (even in the case of deltas).
let items = syncClient.listWithDataId(DATA_ID)
for (key, value) in items {
if let data = value["data"], let uid = value["uid"] {
// do something with item
}
}</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">/// The datasetId needs to be unique for your app and will be used to name the
/// collection in the cloud.
const string DatasetId = "tasks";

foreach (var item in client.List&lt;Task&gt;(DatasetId))
{
/// Do Something with item
}</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-docreate">
<title>$fh.sync.doCreate</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.doCreate(dataset_id, data, success, failure);</programlisting>
<section xml:id="sync-details-5">
<title>Details</title>
<simpara>Update the data associated with the unique id.</simpara>
</section>
<section xml:id="sync-example-4">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

// Record data to create, opaque to sync service.
var data = {
"name": "Organise widgets",
"time": Date.now() + 100000,
"user": "joe@bloggs.com"
};

$fh.sync.doCreate(dataset_id, data, function(res) {
// The update record which will be sent to the cloud
console.log(res);
}, function(code, msg) {
// Error code. One of 'unknown_dataset' or 'unknown_id'
console.error(code);

// Optional free text message with additional information
console.error(msg);

});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">String dataSetId = "tasks";

// Record data to create
JSONObject data = new JSONObject();
data.put("name", "Organise widgets");
data.put("time", new Date().getTime() + 100000);
data.put("user", "joe@bloggs.com");

syncClient.create(dataSetId, data);</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.

#define DATA_ID @"tasks"

NSDate* now = [NSDate date];
NSMutableDictionary* data = [NSMutableDictionary dictionary];
[data setObject:shoppingItem.name forKey:@"name"];
[data setObject:[NSNumber numberWithLongLong:[now timeIntervalSince1970]*1000] forKey:@"created"];
[syncClient createWithDataId:DATA_ID AndData:data];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"

let myItem: [String: AnyObject] = ["name": name, "created": created*1000]

syncClient.createWithDataId(DATA_ID, andData: myItem)</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>In the following section, <literal>client</literal> is a configured and initialised FHSyncClient instance. Task is a class which implements <literal>IFHSyncModel</literal> and has a <literal>string Name</literal> property .</para>
</formalpara>
<programlisting language="csharp" linenumbering="unnumbered">/// The datasetId needs to be unique for your app and will be used to name the
/// collection in the cloud.
const string DatasetId = "tasks";

Task task = new Task();
task.Name = "task name";

client.Create(MainPage.DatasetId, task);</programlisting>
</section>
</section>
<section xml:id="fh-sync-doread">
<title>$fh.sync.doRead</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.doRead(dataset_id, uid, success, failure);</programlisting>
<section xml:id="sync-details-6">
<title>Details</title>
<simpara>Read a single data record.</simpara>
</section>
<section xml:id="sync-example-5">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

// Unique Id of the record to read.
var uid = '42abcdefg';

$fh.sync.doRead(dataset_id, uid, function(data) {
// The record data
console.log(data.data); //the data fileds
console.log(data.hash); //the hash value of the data
}, function(code, msg) {
// Error code. One of 'unknown_dataset' or 'unknown_id'
console.error(code);

// Optional free text message with additional information
console.error(msg);
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">//name of dataset to manage
String dataSetId = "tasks";

// Unique Id of the record to read.
String uid = "42abcdefg";

JSONObject record = FHSyncClient.getInstance().read(dataSetId, uid);

if (data != null) {
JSONObject document = record.getJSONObject("data");
String uid = record.getString("uid");
}</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.

#define DATA_ID @"tasks"

// The data returned by the sync service.
// Always a full data set (even in the case of deltas).
NSDictionary* item = [syncClient readWithDataId:DATA_ID AndUID:@"42abcdefg"];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"

// The data returned by the sync service.
// Always a full data set (even in the case of deltas).
let item = syncClient.readWithDataId(DATA_ID, andUID: "42abcdefg")</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string datasetId = "tasks";

/// Unique Id of the record to read.
string uid = "42abcdefg";

Task task = client.Read(datasetId, uid);</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-doupdate">
<title>$fh.sync.doUpdate</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.doUpdate(dataset_id, uid, data, success, failure);</programlisting>
<section xml:id="sync-details-7">
<title>Details</title>
<simpara>Update the data associated with the unique id.</simpara>
</section>
<section xml:id="sync-example-6">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

// Unique Id of the record to update.
var uid = '42abcdefg';

// Record data to update. Note that you need to provide the FULL data to update.
$fh.sync.doRead(dataset_id, uid, function(data){
var fields = data.data;
fields.name = "Organise layouts";
$fh.sync.doUpdate(dataset_id, uid, fields, function(data) {
// The updated record which will be send to the cloud
console.log(data);
}, function(code, msg) {
// Error code. One of 'unknown_dataset' or 'unknown_id'
console.error(code);

  // Optional free text message with additional information
  console.error(msg);
});
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">// name of dataset to manage
String dataSetId = "tasks";

// Unique Id of the record to read and update.
String uid = "42abcdefg";

// Fetch a record
JSONObject record = FHSyncClient.getInstance().read(dataSetId, uid);

// Fetch the data of the record and change a field
JSONObject data = record.getJSONObject("data");
data.set("newField","newValue");

// Update the data in the sync system
FHSyncClient.getInstance().update(dataSetId, uid, data);</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.
#define DATA_ID @"tasks"

// The Updated data
NSDate* now = [NSDate date];
NSMutableDictionary* data = [NSMutableDictionary dictionary];
[data setObject:shoppingItem.name forKey:@"name"];
[data setObject:[NSNumber numberWithLongLong:[now timeIntervalSince1970]*1000] forKey:@"created"];

NSDictionary* item = [syncClient updateWithDataId:DATA_ID AndUID:@"42abcdefg" AndData:data];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"

// The Updated data
let myItem: [String: AnyObject] = ["name": name, "created": created*1000]
syncClient.updateWithDataId(DATA_ID, andUID: uid, andData: myItem)</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string datasetId = "tasks";

/// Unique Id of the record to read.
string uid = "42abcdefg";

Task task = client.Read(datasetId, uid);

task.Name = "new name";

Task task = client.Update(datasetId, task);</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-dodelete">
<title>$fh.sync.doDelete</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.doDelete(dataset_id, uid, success, failure);</programlisting>
<section xml:id="sync-details-8">
<title>Details</title>
<simpara>Delete the data associated with the unique id.</simpara>
</section>
<section xml:id="sync-example-7">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

// Unique Id of the record to delete.
var uid = '42abcdefg';

$fh.sync.doDelete(dataset_id, uid, function(data) {
// The deleted record data sent to the cloud.
console.log(data);
}, function(code, msg) {
// Error code. One of 'unknown_dataset' or 'unknown_id'
console.error(code);

// Optional free text message with additional information
console.error(msg);
}</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">// name of dataset to manage
String dataSetId = "tasks";

// Unique Id of the record to remove.
String uid = "42abcdefg";

FHSyncClient.getInstance().delete(dataSetId, uid);</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.

#define DATA_ID @"tasks"

NSDictionary* item = [syncClient deleteWithDataId:DATA_ID AndUID:@"42abcdefg"];</programlisting>
</para>
</formalpara>
<simpara>&lt;div class="tab-pane" id="example-doDelete-swift"&gt;</simpara>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"

syncClient.deleteWithDataId(DATA_ID, andUID: uid)</programlisting>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string datasetId = "tasks";

/// Unique Id of the record to delete.
string uid = "42abcdefg";

client.Delete(datasetId, uid);</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-startsync">
<title>$fh.sync.startSync</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.startSync(dataset_id, success, failure)</programlisting>
<section xml:id="sync-details-9">
<title>Details</title>
<simpara>Start the sync loop if 'sync_active' option is set to false.</simpara>
</section>
<section xml:id="sync-example-8">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

$fh.sync.startSync(dataset_id, function(){
console.log('sync loop started');
}, function(error){
console.log('failed to start sync loop. Error : ' + error);
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>The <link xlink:href="http://developer.android.com/training/basics/activity-lifecycle/index.html">Activity lifecycle</link> must be considered if your <literal>FHSyncListener</literal> references an Activity or Fragment. The <literal>pauseSync</literal> and <literal>resumeSync</literal> methods are created for this situation. There is also a <literal>destroy</literal> method which shuts down synchronization entirely.</para>
</formalpara>
<programlisting language="java" linenumbering="unnumbered">// Synchronization is automatically started by the FHSyncClient.init method.
// However, synchronization may be paused and resumed in the Activity
// lifecycle onPause and onResume methods.

@Override
public void onPause() {
super.onPause();
FHSyncClient.getInstance().pauseSync();
}

@Override
public void onResume() {
super.onResume();
FHSyncClient.getInstance().resumeSync(new FHSyncListener() { });
}

public void onDestroy() {
super.onDestroy();
FHSyncClient.getInstance().destroy();
}</programlisting>
<formalpara>
<title>iOS (Objective-C)</title>
<para>There is no <literal>startSync</literal> method in the iOS Synchronization API. Synchronization is started with the <link linkend="fh-sync-init">init</link> method.</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>There is no <literal>startSync</literal> method in the iOS Synchronization API. Synchronization is started with the <link linkend="fh-sync-init">init</link> method.</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string datasetId = "tasks";

client.Start(datasetId);</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-stopsync">
<title>$fh.sync.stopSync</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.stopSync(dataset_id, success, failure)</programlisting>
<section xml:id="sync-details-10">
<title>Details</title>
<simpara>Stop the sync loop for a dataset.</simpara>
</section>
<section xml:id="sync-example-9">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

$fh.sync.stopSync(dataset_id, function(){
console.log('sync loop stopped');
}, function(error){
console.log('failed to stop sync loop. Error : ' + error);
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>The <literal>stop</literal> function will stop synchronizing a dataset but it will not remove the <literal>FHSyncListener</literal> attached to the <literal>FHSyncClient</literal> instance.</para>
</formalpara>
<programlisting language="java" linenumbering="unnumbered">String dataSetId = "tasks";

FHSyncClient.getInstance().stop(dataSetId);</programlisting>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.

#define DATA_ID @"tasks"

[syncClient stopWithDataId:DATA_ID];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"

syncClient.stopWithDataId(DATA_ID)</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string datasetId = "tasks";

client.Stop(datasetId);</programlisting>
</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-dosync">
<title>$fh.sync.doSync</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.doSync(dataset_id, success, failure)</programlisting>
<section xml:id="sync-details-11">
<title>Details</title>
<simpara>Run the sync loop almost immediately (within next 500 ms) if <literal>sync_active</literal> is true.</simpara>
</section>
<section xml:id="sync-example-10">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

$fh.sync.doSync(dataset_id, function(){
console.log('sync loop will run');
}, function(error){
console.log('failed to run sync loop. Error : ' + error);
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>There is no <literal>doSync</literal> method in the Android SDK. Use <link linkend="fh-sync-forcesync">forceSync</link> instead.</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>There is no <literal>doSync</literal> method in the iOS Synchronization API. Use <link linkend="fh-sync-forcesync">forceSync</link> instead.</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>There is no <literal>doSync</literal> method in the iOS Synchronization API. Use <link linkend="fh-sync-forcesync">forceSync</link> instead.</para>
</formalpara>
<formalpara>
<title>NET (C#)</title>
<para>There is no <literal>doSync</literal> method in the Windows Synchronization API. Use <link linkend="fh-sync-forcesync">ForceSync</link> instead.</para>
</formalpara>
</section>
</section>
<section xml:id="fh-sync-forcesync">
<title>$fh.sync.forceSync</title>
<programlisting language="javascript" linenumbering="unnumbered">$fh.sync.forceSync(dataset_id, success, failure)</programlisting>
<section xml:id="sync-details-12">
<title>Details</title>
<simpara>Run the sync loop almost immediately (within next 500 ms) even if <literal>sync_active</literal> is false.</simpara>
</section>
<section xml:id="sync-example-11">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">var dataset_id = 'tasks';

$fh.sync.forceSync(dataset_id, function(){
  console.log('sync loop will run');
}, function(error){
  console.log('failed to run sync loop. Error : ' + error);
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>If a <literal>FHSyncClient</literal> has been "destroyed" with <literal>FHSyncClient.destroy()</literal>, you must call <literal>init</literal> again before calling <literal>forceSync</literal>. When synchronization is paused, a synchronization loop is still performed, but no listeners are attached and no events are fired.</para>
</formalpara>
<programlisting language="java" linenumbering="unnumbered">String dataSetId = "tasks";

FHSyncClient.getInstance().forceSync(dataSetId);</programlisting>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">// Unique Id for the dataset to manage.

#define DATA_ID @"tasks"

[syncClient forceSync:DATA_ID];</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Swift)</title>
<para>
<programlisting language="swift" linenumbering="unnumbered">// Unique Id for the dataset to manage.
public let DATA_ID = "tasks"

syncClient.forceSync(DATA_ID)</programlisting>
</para>
</formalpara>
<formalpara>
<title> .NET (C#)</title>
<para>
<programlisting language="csharp" linenumbering="unnumbered">string datasetId = "tasks";

client.ForceSync(datasetId);</programlisting>
</para>
</formalpara>
</section>
</section>
</chapter>
<chapter xml:id="fh-act">
<title>$fh.act</title>
<caution>
<simpara>This API is now deprecated. Use <link linkend="fh-cloud">$fh.cloud</link> instead.</simpara>
</caution>
<programlisting language="javascript" linenumbering="unnumbered">$fh.act(options, success, failure);</programlisting>
<simpara>Call cloud-side JavaScript functions which receive a JSON object as input and return a JSON
object as output.</simpara>
<itemizedlist xml:id="act-supported-platforms">
<title>Supported Platforms</title>
<listitem>
<simpara>JavaScript SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Cordova</simpara>
</listitem>
<listitem>
<simpara>Web Apps</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Android SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Objective-C SDK</simpara>
</listitem>
<listitem>
<simpara>iOS Swift SDK</simpara>
</listitem>
<listitem>
<simpara>.NET SDK</simpara>
<itemizedlist>
<listitem>
<simpara>Xamarin</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>For detailed version information, see <link xlink:href="https://access.redhat.com/node/2357761">Supported Configurations</link>.</simpara>
<section xml:id="act-example">
<title>Example</title>
<formalpara>
<title>JavaScript</title>
<para>
<programlisting language="javascript" linenumbering="unnumbered">$fh.act({
  "act": "getTweets", // Name of the Cloud function to call
  "req": {
    "qs": "feedhenry" // Set of key/value pairs that are passed as paramaters to the Cloud function
  },
  "secure": true, // Whether or not to use https for the Cloud call. Default: true
  "timeout": 25000 // timeout value specified in milliseconds. Default: 60000 (60s)
}, function(res) {
  // Cloud call was successful. Alert the response
  alert('Got response from cloud:' + JSON.stringify(res));
}, function(msg,err) {
  // An error occured during the cloud call. Alert some debugging information
  alert('Cloud call failed with error message:' + msg + '. Error properties:' + JSON.stringify(err));
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>Android (Java)</title>
<para>
<programlisting language="java" linenumbering="unnumbered">//build the request object. The first parameter is the name of the cloud side function to be called,
//the second parameter is the data parameter for the function
FHActRequest request = FH.buildActRequest("getTweets", new JSONObject().put("qs", "feedhenry"));
//the request will be executed asynchronously
request.executeAsync(new FHActCallback() {
  @Override
  public void success(FHResponse res) {
    //the function to execute if the request is successful
    try {
      JSONArray resObj = res.getJson().getJSONArray("tweets");
      Log.d(TAG, resObj.toString(2));
      for(int i=0;i&lt;resObj.length();i++){
        JSONObject event = resObj.getJSONObject(i);
        ...
      }
    } catch(Exception e){
      Log.e(TAG, e.getMessage(), e);
    }
  }

  @Override
  public void fail(FHResponse res) {
    //the function to execute if the request is failed
    Log.e(TAG, res.getErrorMessage(), res.getError());
  }
});</programlisting>
</para>
</formalpara>
<formalpara>
<title>iOS (Objective-C)</title>
<para>
<programlisting language="objectivec" linenumbering="unnumbered">FHActRequest * action = (FHActRequest *) [FH buildActRequest:@"getTweets" WithArgs:[NSDictionary dictionaryWithObject:@"feedhenry" forKey:@"qs"]];
  [action execAsyncWithSuccess:^(FHResponse * actRes){
    //the actRes will contain 10 tweets about "feedhenry"
    //the JSON response from the cloud will be parsed to NSDictionary automatically
    NSDictionary* resData = actRes.parsedResponse;
    NSArray * tweets = (NSArray *) [resData objectForKey:@"tweets"];
    //display tweets in the UI
...
} AndFailure:^(FHResponse * actFailRes){
  //if there is any error, you can check the rawResponse string
  NSLog(@"Failed to read tweets. Response = %@", actFailRes.rawResponse);
  }
];
//You can also use the delegate pattern with the FHActRequet object. If you use that pattern, you need to implement the FHResponseDelegate protocol and assign an instance to the FHActRequest instance. When the request is executed, replace the blocks with __nil__.</programlisting>
</para>
</formalpara>
</section>
</chapter>
</book>